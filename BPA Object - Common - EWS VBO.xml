<process name="Common - EWS VBO" version="1.0" bpversion="6.3.0.6190" narrative="This will automate E-Mail process" byrefcollection="true" type="object" runmode="Background" preferredid="1791d92e-bc8b-4a83-8939-90c0f689a258">
  <appdef>
    <element name="Outlook - Email">
      <id>c5feb0bb-fa82-43ba-af99-97ab61d201ca</id>
      <type>Application</type>
      <basetype>Application</basetype>
      <datatype>unknown</datatype>
      <diagnose>False</diagnose>
    </element>
    <apptypeinfo>
      <id>Win32Attach</id>
      <parameters>
        <parameter>
          <name>WindowTitle</name>
          <value>
          </value>
        </parameter>
        <parameter>
          <name>ProcessName</name>
          <value>
          </value>
        </parameter>
        <parameter>
          <name>Path</name>
          <value>
          </value>
        </parameter>
        <parameter>
          <name>CommandLineParams</name>
          <value>
          </value>
        </parameter>
        <parameter>
          <name>NonInvasive</name>
          <value>True</value>
        </parameter>
        <parameter>
          <name>ProcessMode</name>
          <value>Internal</value>
        </parameter>
        <parameter>
          <name>ExternalProcessTimeout</name>
          <value>0</value>
        </parameter>
        <parameter>
          <name>Options</name>
        </parameter>
      </parameters>
    </apptypeinfo>
  </appdef>
  <view>
    <camerax>-100</camerax>
    <cameray>-29</cameray>
    <zoom version="2">1.25</zoom>
  </view>
  <preconditions />
  <endpoint narrative="" />
  <subsheet subsheetid="7248534e-f846-4ee6-af3a-6277ebf540ae" type="CleanUp" published="True">
    <name>Clean Up</name>
    <view>
      <camerax>-180</camerax>
      <cameray>60</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="9fea642b-bef0-47db-8111-3c798959b161" type="Normal" published="True">
    <name>List emails within Datetime</name>
    <view>
      <camerax>-127</camerax>
      <cameray>44</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="33693b0c-1272-4a99-bf9a-d457e4b4c290" type="Normal" published="True">
    <name>List emails within Datetime - Fast</name>
    <view>
      <camerax>-127</camerax>
      <cameray>44</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="0a017ee4-af96-44fa-8356-8c20e92a3f48" type="Normal" published="True">
    <name>Reply Email</name>
    <view>
      <camerax>-183</camerax>
      <cameray>122</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="4a0e5d5a-994e-4f7b-bf43-823f13c928d3" type="Normal" published="True">
    <name>Get Email</name>
    <view>
      <camerax>-93</camerax>
      <cameray>17</cameray>
      <zoom version="2">1.5625</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="51430e91-6279-4abe-8d01-97f40f8bc2cc" type="Normal" published="True">
    <name>Get Email By UniqueID</name>
    <view>
      <camerax>-50</camerax>
      <cameray>49</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="2ea9bff2-d376-418b-a134-ed38ce1c9903" type="Normal" published="True">
    <name>Get Email By UniqueID - Overload</name>
    <view>
      <camerax>-282</camerax>
      <cameray>160</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="30f9d029-16b2-471e-b882-1f8553a514ca" type="Normal" published="True">
    <name>Mark Email as ReadOrUnRead</name>
    <view>
      <camerax>0</camerax>
      <cameray>92</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="f355daca-fdc3-4bca-870b-8f3f5ca4e1c1" type="Normal" published="True">
    <name>Get Email ReadOrUnread Status</name>
    <view>
      <camerax>0</camerax>
      <cameray>152</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="695b9d07-0599-4460-92b1-46fb3aa0265c" type="Normal" published="True">
    <name>Configure EWS</name>
    <view>
      <camerax>-162</camerax>
      <cameray>95</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="abc8131f-23fb-4ca2-99ab-046fc33f176d" type="Normal" published="True">
    <name>Distribution List</name>
    <view>
      <camerax>-123</camerax>
      <cameray>-26</cameray>
      <zoom version="2">1.5625</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="527af26a-0380-4b23-bf67-fbfaf94f5412" type="Normal" published="True">
    <name>Send Email</name>
    <view>
      <camerax>-110</camerax>
      <cameray>-76</cameray>
      <zoom version="2">1.5625</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="225ea648-4849-46a0-8a10-f8e8552c1360" type="Normal" published="True">
    <name>Move Email</name>
    <view>
      <camerax>68</camerax>
      <cameray>46</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="557e45e7-d6bf-4bfd-a5b7-dbe07440f87f" type="Normal" published="True">
    <name>Delete Email</name>
    <view>
      <camerax>-43</camerax>
      <cameray>50</cameray>
      <zoom version="2">1.5625</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="e5b54855-36be-4fb9-9765-9376d41fb2ff" type="Normal" published="True">
    <name>Forward Email</name>
    <view>
      <camerax>-134</camerax>
      <cameray>103</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="646e7a7c-460a-4c99-8260-d3f68c1b3076" type="Normal" published="True">
    <name>Forward Email Special 2</name>
    <view>
      <camerax>0</camerax>
      <cameray>125</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="4ee2dc4d-dc00-429a-9195-eab4a5570870" type="Normal" published="True">
    <name>Forward Email Special</name>
    <view>
      <camerax>-134</camerax>
      <cameray>103</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="a6472286-536c-49fc-bf03-869a0445e1f4" type="Normal" published="True">
    <name>Save Email</name>
    <view>
      <camerax>-151</camerax>
      <cameray>71</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <subsheet subsheetid="61d804a6-447d-4e08-ac90-db41c3ea1a93" type="Normal" published="True">
    <name>Get Contacts</name>
    <view>
      <camerax>-282</camerax>
      <cameray>0</cameray>
      <zoom version="2">1.25</zoom>
    </view>
  </subsheet>
  <stage stageid="138320cf-a143-420d-9589-d67687da8320" name="Start" type="Start">
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>92cd9b96-3e53-4bec-aad5-07afce30bf8f</onsuccess>
  </stage>
  <stage stageid="92cd9b96-3e53-4bec-aad5-07afce30bf8f" name="End" type="End">
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="d4f211ce-0df3-4de0-943e-743ef96c5ebb" name="Stage1" type="ProcessInfo">
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <references>
      <reference>System.dll</reference>
      <reference>System.Data.dll</reference>
      <reference>System.Xml.dll</reference>
      <reference>System.Drawing.dll</reference>
      <reference>C:\Program Files\Microsoft\Exchange\Web Services\2.2\Microsoft.Exchange.WebServices.dll</reference>
      <reference>C:\Program Files\Microsoft\Exchange\Web Services\2.2\Microsoft.Exchange.WebServices.Auth.dll</reference>
      <reference>System.Core.dll</reference>
    </references>
    <imports>
      <import>System</import>
      <import>System.Drawing</import>
      <import>System.Data</import>
      <import>Microsoft.Exchange.WebServices.Data</import>
      <import>System.Collections.Generic</import>
      <import>System.Net</import>
      <import>System.IO</import>
    </imports>
    <language>csharp</language>
    <globalcode><![CDATA[]]></globalcode>
    <code><![CDATA[private ExchangeService service =null;
private bool connected = false;

private bool setService(string MailAddress,string Password)
{
	service = new ExchangeService(ExchangeVersion.Exchange2010_SP2);
	service.Credentials = new NetworkCredential(MailAddress,Password);
	service.Url = new Uri("https://outlook.office365.com/EWS/Exchange.asmx");
	
	FolderId folderId = new FolderId(WellKnownFolderName.Inbox);
	Folder Inbox = Folder.Bind(service,folderId );
	connected=true;
	return connected;
}
private bool setService(string MailAddress,string Password,string SharedMailbox)
{
	service = new ExchangeService(ExchangeVersion.Exchange2010_SP2);
	service.Credentials = new NetworkCredential(MailAddress,Password);
	service.Url = new Uri("https://outlook.office365.com/EWS/Exchange.asmx");
	
	FolderId folderId = new FolderId(WellKnownFolderName.Inbox,SharedMailbox);
	Folder Inbox = Folder.Bind(service,folderId );
	connected=true;
	return connected;
}

private System.Data.DataTable createEmailTable()
{
    System.Data.DataTable email = new System.Data.DataTable("Email");
    email.Columns.Add("ID", typeof(String));
    email.Columns.Add("Subject", typeof(String));
    email.Columns.Add("From", typeof(System.Data.DataTable));
    email.Columns.Add("To", typeof(System.Data.DataTable));
    email.Columns.Add("RecievedAt", typeof(String));
    email.Columns.Add("BodyFormat", typeof(String));
    email.Columns.Add("BodyPlain", typeof(String));
    email.Columns.Add("BodyHtml", typeof(String));
	email.Columns.Add("Attachment", typeof(System.Data.DataTable));
    return email;
}

private System.Data.DataTable createEmailTableFast()
{
    System.Data.DataTable email = new System.Data.DataTable("Email");
    email.Columns.Add("ID", typeof(String));
    email.Columns.Add("Subject", typeof(String));
    email.Columns.Add("From", typeof(System.Data.DataTable));
    //email.Columns.Add("To", typeof(System.Data.DataTable));
    email.Columns.Add("RecievedAt", typeof(String));
    //email.Columns.Add("BodyFormat", typeof(String));
    //email.Columns.Add("BodyPlain", typeof(String));
    //email.Columns.Add("BodyHtml", typeof(String));
	//email.Columns.Add("Attachment", typeof(System.Data.DataTable));
    return email;
}

private void addEmailToCollection(System.Data.DataTable table, EmailMessage message)
{
    System.Data.DataRow currentRow = table.NewRow();
    String id = message.Id.UniqueId;
    String subject = message.Subject;
    String from_name = message.From.Name;
    String from_address = message.From.Address;
    // Sender Information
    System.Data.DataTable senderTable = new System.Data.DataTable("Sender");
    senderTable.Columns.Add("Name");
    senderTable.Columns.Add("Email");
    System.Data.DataRow senderRow = senderTable.NewRow();
    senderRow.ItemArray = new Object[] { from_name, from_address };
    senderTable.Rows.Add(senderRow);

    // Recipients Information
    System.Data.DataTable to = new System.Data.DataTable("Recipients");
    to.Columns.Add("Name", typeof(String));
    to.Columns.Add("Email", typeof(String));
    foreach (EmailAddress toAddress in message.ToRecipients)
    {
        System.Data.DataRow newToRow = to.NewRow();
        newToRow.ItemArray = new Object[] { toAddress.Name, toAddress.Address };
        to.Rows.Add(newToRow);
    }

    String recieved_at = message.DateTimeReceived.ToString();

    PropertySet properties = (BasePropertySet.FirstClassProperties);
    properties.RequestedBodyType = BodyType.Text;
    message.Load(properties);
    String body_plain = message.Body;

    properties.RequestedBodyType = BodyType.HTML;
    message.Load(properties);
    String body_html = message.Body;
    String body_format = "HTML";
	
	// Attachment Information
    System.Data.DataTable attachments = new System.Data.DataTable("attach");
    attachments.Columns.Add("Name", typeof(String));
    attachments.Columns.Add("Type", typeof(String));
	foreach (Attachment attachment in message.Attachments)
    {
        System.Data.DataRow newRow = attachments.NewRow();
        newRow.ItemArray = new Object[] { attachment.Name, attachment.Size};
        attachments.Rows.Add(newRow);
	}
    currentRow.ItemArray = new Object[] { id, subject, senderTable, to, recieved_at, body_format, body_plain, body_html,attachments };

    table.Rows.Add(currentRow);
}

private void addEmailToCollectionFast(System.Data.DataTable table, EmailMessage message)
{
    System.Data.DataRow currentRow = table.NewRow();
    String id = message.Id.UniqueId;
    String subject = message.Subject;
    String from_name = message.From.Name;
    String from_address = message.From.Address;
    // Sender Information
    System.Data.DataTable senderTable = new System.Data.DataTable("Sender");
    senderTable.Columns.Add("Name");
    senderTable.Columns.Add("Email");
    System.Data.DataRow senderRow = senderTable.NewRow();
    senderRow.ItemArray = new Object[] { from_name, from_address };
    senderTable.Rows.Add(senderRow);

    // Recipients Information
    //System.Data.DataTable to = new System.Data.DataTable("Recipients");
    //to.Columns.Add("Name", typeof(String));
    //to.Columns.Add("Email", typeof(String));
    //foreach (EmailAddress toAddress in message.ToRecipients)
    //{
      //  System.Data.DataRow newToRow = to.NewRow();
        //newToRow.ItemArray = new Object[] { toAddress.Name, toAddress.Address };
        //to.Rows.Add(newToRow);
    //}

    String recieved_at = message.DateTimeReceived.ToString();

    //PropertySet properties = (BasePropertySet.FirstClassProperties);
    //properties.RequestedBodyType = BodyType.Text;
    //message.Load(properties);
    //String body_plain = message.Body;

    //properties.RequestedBodyType = BodyType.HTML;
    //message.Load(properties);
    //String body_html = message.Body;
    //String body_format = "HTML";
	
	// Attachment Information
    //System.Data.DataTable attachments = new System.Data.DataTable("attach");
    //attachments.Columns.Add("Name", typeof(String));
    //attachments.Columns.Add("Type", typeof(String));
	//foreach (Attachment attachment in message.Attachments)
    //{
        //System.Data.DataRow newRow = attachments.NewRow();
        //newRow.ItemArray = new Object[] { attachment.Name, attachment.Size};
      //  attachments.Rows.Add(newRow);
	//}
    currentRow.ItemArray = new Object[] { id, subject, senderTable,  recieved_at};

    table.Rows.Add(currentRow);
}


private FolderId getFolderId(string SharedMailbox, string folderName)
{
	FolderId folderId = new FolderId(WellKnownFolderName.MsgFolderRoot,SharedMailbox);
	FolderView fview = new FolderView(10000);
	FindFoldersResults findfolderResults = service.FindFolders(folderId ,new FolderView(10000) { Traversal =FolderTraversal.Deep}); 
	foreach(Folder folder in findfolderResults)
	{
		if(folder.DisplayName==folderName)
		{
			folderId=folder.Id;
			return folderId;
		}
	}
	return getFolderIdFromInbox(SharedMailbox,folderName);
}



private FolderId getFolderIdFromInbox(string SharedMailbox, string folderName)
{
	FolderId folderId = new FolderId(WellKnownFolderName.Inbox,SharedMailbox);
	FolderView fview = new FolderView(10000);
	FindFoldersResults findfolderResults = service.FindFolders(folderId ,new FolderView(10000) { Traversal =FolderTraversal.Deep}); 
	foreach(Folder folder in findfolderResults)
	{
		if(folder.DisplayName==folderName)
		{
			folderId=folder.Id;
			return folderId;
		}
	}
	return null;
}
private FolderId getFolderId( string folderName)
{
	FolderId folderId = new FolderId(WellKnownFolderName.MsgFolderRoot);
	FolderView fview = new FolderView(10000);
	FindFoldersResults findfolderResults = service.FindFolders(folderId ,new FolderView(10000) { Traversal =FolderTraversal.Deep}); 
	foreach(Folder folder in findfolderResults)
	{
		if(folder.DisplayName==folderName)
		{
			folderId=folder.Id;
			return folderId;
		}
	}
	return getFolderIdFromInbox(folderName);
}
private FolderId getFolderIdFromInbox( string folderName)
{
	FolderId folderId = new FolderId(WellKnownFolderName.Inbox);
	FolderView fview = new FolderView(10000);
	FindFoldersResults findfolderResults = service.FindFolders(folderId ,new FolderView(10000) { Traversal =FolderTraversal.Deep}); 
	foreach(Folder folder in findfolderResults)
	{
		if(folder.DisplayName==folderName)
		{
			folderId=folder.Id;
			return folderId;
		}
	}
	return null;
}

private List<EmailMessage> getMail(SearchFilter filter,FolderId fid)
{
    List<EmailMessage> emails = new List<EmailMessage>();
	FolderId folderId = fid;

    ItemView view = new ItemView(1);
	view.OrderBy.Add(ItemSchema.DateTimeReceived,SortDirection.Ascending);
    FindItemsResults<Item> searchResults;


        searchResults = service.FindItems(folderId, filter, view);
        foreach (var item in searchResults.Items)
        {
            EmailMessage m = (EmailMessage)item;
            emails.Add((EmailMessage)item);
        }

    if (emails.Count > 0)
    {
        PropertySet properties = (BasePropertySet.FirstClassProperties);
        service.LoadPropertiesForItems(emails, properties);
    }
    return emails;
}

private List<EmailMessage> getListOfMails(SearchFilter filter,FolderId fid)
{
    List<EmailMessage> emails = new List<EmailMessage>();
	FolderId folderId = fid;

    int pageSize = 1;
    bool hasMore = true;
    ItemView view = new ItemView(pageSize, 0, OffsetBasePoint.Beginning);
	view.OrderBy.Add(ItemSchema.DateTimeReceived,SortDirection.Ascending);    
    FindItemsResults<Item> searchResults;

    while (hasMore)
    {
        searchResults = service.FindItems(folderId, filter, view);
        foreach (var item in searchResults.Items)
        {
            EmailMessage m = (EmailMessage)item;
            emails.Add((EmailMessage)item);
        }
        hasMore = searchResults.MoreAvailable;
        if (hasMore)
        {
            view.Offset += pageSize;
        }
    }

    if (emails.Count > 0)
    {
        PropertySet properties = (BasePropertySet.FirstClassProperties);
        service.LoadPropertiesForItems(emails, properties);
    }
    return emails;
}


private  void DownloadMime(Attachment attachment , string AttachmentDirectory )
{
		 PropertySet psPropSet = new PropertySet(BasePropertySet.FirstClassProperties);
        psPropSet.Add(ItemSchema.MimeContent);
	if (attachment is ItemAttachment)
            {
                attachment.Load();
                if (((ItemAttachment)attachment).Item is EmailMessage)
                {
                    EmailMessage ebMessage = ((ItemAttachment)attachment).Item as EmailMessage;
                    foreach (Attachment ebAttachment in ebMessage.Attachments)
                    {
                        if (ebAttachment is ItemAttachment)
                        {
                            Attachment[] LoadAttachments = new Attachment[1];
                            LoadAttachments[0] = ebAttachment;
                            ServiceResponseCollection<GetAttachmentResponse> getAttachmentresps = service.GetAttachments(LoadAttachments, BodyType.HTML, psPropSet);
                            foreach (GetAttachmentResponse grResp in getAttachmentresps)
                            {
                                EmailMessage msg = ((ItemAttachment)grResp.Attachment).Item as EmailMessage;
                                msg.Load(new PropertySet(ItemSchema.MimeContent));
                                byte[] content = msg.MimeContent.Content;
								
													
							
                            }
                        }
                    }
					byte[] contentMSG = ebMessage.MimeContent.Content; 						
							Stream Item2Disk = new FileStream(@AttachmentDirectory+attachment.Name + ".msg", FileMode.Create);
							Item2Disk.Write(contentMSG , 0, contentMSG.Length);
							Item2Disk.Flush();
							Item2Disk.Close();		

                }
				
				
							
							
            }

	}]]></code>
  </stage>
  <stage stageid="63aa87d1-0737-4b49-8bdd-cdefd20f5dfd" name="Clean Up" type="SubSheetInfo">
    <subsheetid>7248534e-f846-4ee6-af3a-6277ebf540ae</subsheetid>
    <narrative>
    </narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="3bd3c057-0644-45a2-936d-0e863a51343d" name="Start" type="Start">
    <subsheetid>7248534e-f846-4ee6-af3a-6277ebf540ae</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>23e7615c-aae7-421e-958c-b4e48b98f125</onsuccess>
  </stage>
  <stage stageid="23e7615c-aae7-421e-958c-b4e48b98f125" name="End" type="End">
    <subsheetid>7248534e-f846-4ee6-af3a-6277ebf540ae</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="8bdf156f-8ca3-4ade-866f-c7b0bfc478bf" name="Note1" type="Note">
    <subsheetid>7248534e-f846-4ee6-af3a-6277ebf540ae</subsheetid>
    <loginhibit />
    <narrative>Clean Up Page

This is an optional page where you might choose to perform some finalisation (or "cleanup") tasks as your business object is closed down.

The cleanup action will be called automatically immediately after closing your business object at the end of a business process.

You will not be able to call this action from a business process, nor will it be called at any other time than before the disposal of the business object.</narrative>
    <displayx>-180</displayx>
    <displayy>60</displayy>
    <displaywidth>180</displaywidth>
    <displayheight>230</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="2e6b5f40-3006-4545-bc52-4ff21cfd6e4d" name="Note2" type="Note">
    <narrative>Initialise Page

This is an optional page where you might choose to perform some initialisation tasks after your business object is loaded.

The initialise action will be called automatically immediately after loading your business object.

You will not be able to call this action from a business process, nor will it be called at any other time than after the creation of the object.</narrative>
    <displayx>-180</displayx>
    <displayy>60</displayy>
    <displaywidth>180</displaywidth>
    <displayheight>230</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="47c185eb-d799-4f94-be70-6e1a5808a26b" name="List emails within Datetime" type="SubSheetInfo">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <narrative>Returns all emails for within the Time Period</narrative>
    <displayx>-330</displayx>
    <displayy>-120</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="c0f3caf4-ab8f-423d-b7a9-2add1ea8e43e" name="Start" type="Start">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-30</displayx>
    <displayy>-150</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Shared Mailbox" narrative="Mail address of Shared mailbox (if any)" stage="txt_SharedMailbox" />
      <input type="text" name="Mail Subject" narrative="Subject of the Email" stage="txt_MailSubject" />
      <input type="text" name="Sub Folder" narrative="Mail Folder to look for mails" stage="txt_SubFolder" />
      <input type="flag" name="Unread Only?" narrative="Get only Unread emails" stage="flag_UnreadOnly" />
      <input type="datetime" name="Mail Start Time" narrative="Mail Start Time" stage="dt_MailStartTime" />
      <input type="datetime" name="Mail End Time" narrative="Mail End Time" stage="dt_MailEndTime" />
    </inputs>
    <onsuccess>d87603ee-f509-4b8e-9b75-8a1126b8e5c4</onsuccess>
  </stage>
  <stage stageid="e273285d-aaf7-4128-ae1b-7c49c4e162ff" name="End" type="End">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-30</displayx>
    <displayy>30</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="collection" name="Email" narrative="Email Collection" stage="coll_Email" />
      <output type="flag" name="Mail Found" narrative="Mail Found" stage="flag_Success" />
      <output type="text" name="Error Message" narrative="Error message if any" stage="txt_ErrorMessage" />
    </outputs>
  </stage>
  <stage stageid="06e0416d-39d8-4a73-8832-bcb6ef91345d" name="coll_Email" type="Collection">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <narrative>Collection of emails</narrative>
    <displayx>-330</displayx>
    <displayy>180</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>collection</datatype>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="554b96d8-5b3c-4537-a6e5-8ab704795da9" name="Configure EWS" type="SubSheetInfo">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <narrative>Configure EWS service with the credentials provided</narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="ca6c5cc2-6607-48bb-b8a9-6fab39168f8a" name="Start" type="Start">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Mail Address" narrative="Primary Mail address" stage="txt_MailAddress" />
      <input type="password" name="Password" narrative="Password" stage="pass_Password" />
      <input type="text" name="Shared Mailbox" narrative="Shared account mail address if any" stage="txt_SharedMailbox" />
    </inputs>
    <onsuccess>f76aca0a-8843-4a1a-a2c0-ce950ada08f5</onsuccess>
  </stage>
  <stage stageid="71cf4fc8-ab85-4cbb-8de6-ac40c605e0fb" name="End" type="End">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>240</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Configured" narrative="Success Flag" stage="flag_Configured" />
      <output type="text" name="ErrorMessage" narrative="Error message if any" stage="txt_ErrorMessage" />
    </outputs>
  </stage>
  <stage stageid="4769ee32-633b-4e6a-8813-bf5b7aa22aff" name="Configure EWS" type="Code">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>120</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="MailAddress" expr="[txt_MailAddress]" />
      <input type="password" name="Password" expr="[pass_Password]" />
      <input type="text" name="SharedMailbox" expr="[txt_SharedMailbox]" />
    </inputs>
    <outputs>
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
      <output type="flag" name="Configured" stage="flag_Configured" />
    </outputs>
    <onsuccess>d4ed9d83-2a33-4fff-add6-f738f47e9fea</onsuccess>
    <code><![CDATA[ErrorMessage="";
Configured=false;
try
{
	if(SharedMailbox!="")
	{
		Configured=setService(MailAddress,Password,SharedMailbox);
	}
	else
	{
		Configured=setService(MailAddress,Password);
	}
	
}
catch(Exception ex)
{
	ErrorMessage=ex.Message;
}
]]></code>
  </stage>
  <stage stageid="e27ff81d-3332-47e3-915c-57d55fc71898" name="txt_MailAddress" type="Data">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <loginhibit />
    <narrative>Mail Address</narrative>
    <displayx>-210</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue xml:space="preserve">Bidrpabott1@sodexo.com</initialvalue>
    <alwaysinit />
  </stage>
  <stage stageid="248a8c3a-d019-429a-9e53-49cf50084374" name="pass_Password" type="Data">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <loginhibit />
    <narrative>Password for mailbox</narrative>
    <displayx>-210</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>password</datatype>
    <initialvalueenc>17,20,7,67,26,91,6,1,112,84</initialvalueenc>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="87a53f2f-7fbd-4702-b008-c4f0be7eb130" name="Distribution List" type="SubSheetInfo">
    <subsheetid>abc8131f-23fb-4ca2-99ab-046fc33f176d</subsheetid>
    <narrative>Checks whether a user exists in a Distribution list</narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="046a7acc-ea9f-4d38-8e43-1a7b9b6afd0a" name="Start" type="Start">
    <subsheetid>abc8131f-23fb-4ca2-99ab-046fc33f176d</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Distribution List Name" narrative="Distribution List Name" stage="txt_DistributionListName" />
      <input type="text" name="Member Name" narrative="List Member Name" stage="txt_MemberName" />
    </inputs>
    <onsuccess>e068bb40-a600-44c5-bcd2-2b33b4785c09</onsuccess>
  </stage>
  <stage stageid="62a4c5cb-9544-4c99-9f3f-aab8e3a5f9b0" name="End" type="End">
    <subsheetid>abc8131f-23fb-4ca2-99ab-046fc33f176d</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="IsUserInDL" narrative="Return whether the User exists in DL or not" stage="flag_IsUserInDL" />
      <output type="text" name="ErrorMessage" narrative="Error message if any" stage="txt_ErrorMessage" />
      <output type="text" name="MemebersListofDL" narrative="Members of the Distribution List" stage="txt_Result" />
    </outputs>
  </stage>
  <stage stageid="c3c43f6c-6073-43ac-98c7-ee06c01b86fe" name="Get Members of Distribution List" type="Code">
    <subsheetid>abc8131f-23fb-4ca2-99ab-046fc33f176d</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>30</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="DistributionListName" expr="[txt_DistributionListName]" />
      <input type="text" name="MemberName" expr="[txt_MemberName]" />
    </inputs>
    <outputs>
      <output type="text" name="LMemebers" stage="txt_Result" />
      <output type="flag" name="IsMemberExistsInDL" stage="flag_IsUserInDL" />
    </outputs>
    <onsuccess>62a4c5cb-9544-4c99-9f3f-aab8e3a5f9b0</onsuccess>
    <code><![CDATA[IsMemberExistsInDL=false;
LMemebers= "";  
try
{
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured.Please call 'Configure EWS' action first");
	}
	
	ExpandGroupResults dlGroupMembers = service.ExpandGroup(DistributionListName);
		 foreach (EmailAddress address in dlGroupMembers.Members)
		 {
			  LMemebers += address.Name + System.Environment.NewLine;
			  if(address.Name==MemberName)
			  {
				  IsMemberExistsInDL=true;
				  break;
			  }
		 }
}
catch(Exception ex)
{
	LMemebers=ex.Message;
}]]></code>
  </stage>
  <stage stageid="8699dc28-8713-4f35-bdfd-03dffe7abfb7" name="txt_Result" type="Data">
    <subsheetid>abc8131f-23fb-4ca2-99ab-046fc33f176d</subsheetid>
    <narrative>Result containing members</narrative>
    <displayx>-180</displayx>
    <displayy>270</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="2c145294-5464-471f-b576-b4b888a4a45c" name="txt_DistributionListName" type="Data">
    <subsheetid>abc8131f-23fb-4ca2-99ab-046fc33f176d</subsheetid>
    <loginhibit />
    <narrative>Names in a distribution list</narrative>
    <displayx>-210</displayx>
    <displayy>15</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="68618c3e-e03e-49e3-ae96-d43429df79f1" name="Move Email" type="SubSheetInfo">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <narrative>Moves a mail from one folder to another</narrative>
    <displayx>-300</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="c5d1cd80-e2b3-4e13-90d8-d9a680a01b8e" name="Start" type="Start">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>-180</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="MessageId" stage="txt_MessageId" />
      <input type="text" name="SharedMailboxAddress" narrative="Mail address of Shared mailbox (if any)" stage="txt_SharedMailbox" />
      <input type="text" name="MoveToFolder" stage="txt_MoveToFolder" />
    </inputs>
    <onsuccess>d1a8aafc-7de5-4785-940a-ec4d72d5f326</onsuccess>
  </stage>
  <stage stageid="1903c0a3-c03b-43b2-a370-d5d3436b8f5d" name="End" type="End">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>210</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="text" name="ErrorMessage" narrative="Error message if any" stage="txt_ErrorMessage" />
      <output type="flag" name="MailMoved" narrative="Success or Failure of moving the mail" stage="flag_MailMoved" />
      <output type="text" name="MovedMailID" narrative="Mail ID of the newly moved mail" stage="txt_MovedMailId" />
    </outputs>
  </stage>
  <stage stageid="83fc919f-95b7-4522-b41c-a3bb7d34a16c" name="Move Mail" type="Code">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="ID" expr="[txt_MessageId]" />
      <input type="text" name="SharedMailboxAddress" expr="[txt_SharedMailbox]" />
      <input type="text" name="MoveToFolder" expr="[txt_MoveToFolder]" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" stage="flag_MailMoved" />
      <output type="text" name="MovedMailId" stage="txt_MovedMailId" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
    </outputs>
    <onsuccess>7682b50c-e65f-4a0f-bc5f-31fe222c15f9</onsuccess>
    <code><![CDATA[Success=false;
MovedMailId="";
ErrorMessage="";

try
{
	//Not connected
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured. Please call 'Configure EWS' action first");
	}
	//Move to Folder is empty
	if(MoveToFolder=="")
	{
		throw new Exception("Error in Move Email: MoveToFolder is empty. Please provide a Folder Name.");
	}
	//Bind mail 
	EmailMessage email = EmailMessage.Bind(service, new ItemId(ID));
	FolderId moveFolderId = null;
	Item mailItem = null;
	EmailMessage movedMail = null;
	if(email!=null)
	{
		//Get FolderId of the folder where mail need to be moved
		if(SharedMailboxAddress!=null)
		{	
			moveFolderId = getFolderId(SharedMailboxAddress,MoveToFolder);
		}
		else
		{	
			moveFolderId = getFolderId(MoveToFolder);
		}
		// Move mail to the folder and capture the new Mail Unique ID
		if(moveFolderId!=null)
		{
			mailItem=email.Move(moveFolderId);
			movedMail = EmailMessage.Bind(service,mailItem.Id);
			MovedMailId=movedMail.Id.UniqueId;
			Success =true;
		}
		//Folder not available in the Mailbox
		else
		{
			throw new Exception("Error in Move Mail: Unable to find the mentioned Folder : '"+MoveToFolder+"'");
		}
	}
}
catch(Exception ex)
{
	Success =false; 
	ErrorMessage=ex.Message;
}]]></code>
  </stage>
  <stage stageid="de14dc97-77ce-4b7c-a47e-ca74b4390256" name="txt_SharedMailbox" type="Data">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <narrative>Shared mailbox name</narrative>
    <displayx>-300</displayx>
    <displayy>60</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="17eaded6-91a2-4d5f-ba36-4bfb110da3cd" name="Reply Email" type="SubSheetInfo">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <narrative>Replies to an already existing mail</narrative>
    <displayx>-330</displayx>
    <displayy>-120</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="bab44c65-bc01-4b9c-807e-7003bf16e862" name="Start" type="Start">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-150</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Message Id" narrative="Unique ID of the mail message" stage="txt_MessageId" />
      <input type="text" name="Shared Mailbox" narrative="Mail address of the Shared mailbox if any" stage="txt_SharedMailbox" />
      <input type="flag" name="Repy to All" narrative="Reply to All" stage="flag_ReplyAll" />
      <input type="text" name="Reply Message" narrative="Mail message to be added in the body" stage="txt_Replymessage" />
      <input type="text" name="Mail Attachments" narrative="The attachemnts to be added(full path with file name). If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_MailAttachments" />
      <input type="text" name="Additional To Recipients" narrative="The email address to be added in the To list in addition to original recipients. If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_To" />
      <input type="text" name="Additional CC Recipients" narrative="The email address to be added in the CC list in addition to original recipients. If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_CC" />
    </inputs>
    <onsuccess>c27084e1-5b69-480a-9c34-5d9ce10d94b6</onsuccess>
  </stage>
  <stage stageid="4d0cdf97-0b4d-4136-b65c-6bbe605279d8" name="End" type="End">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Reply Sent" narrative="Flag.Returns the status of the reply Sent" stage="flag_ReplySent" />
      <output type="text" name="Error Message" narrative="Error message if any" stage="txt_ErrorMessage" />
    </outputs>
  </stage>
  <stage stageid="559a28dd-2264-4445-a1a8-881ec0b8e43c" name="Reply to Mail" type="Code">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-30</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="ID" expr="[txt_MessageId]" />
      <input type="flag" name="ReplyAll" expr="[flag_ReplyAll]" />
      <input type="text" name="ReplyMessage" expr="[txt_Replymessage]" />
      <input type="text" name="MailAttachments" expr="[txt_MailAttachments]" />
      <input type="text" name="SharedMailboxAddress" expr="[txt_SharedMailbox]" />
      <input type="text" name="To" expr="[txt_To]" />
      <input type="text" name="CC" expr="[txt_CC]" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" stage="flag_ReplySent" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
    </outputs>
    <onsuccess>4d0cdf97-0b4d-4136-b65c-6bbe605279d8</onsuccess>
    <code><![CDATA[Success = false;
ErrorMessage = "";
FolderId SentItemsFolderId = null;
FolderId DraftsFolderId = null;
try
{
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured.Please call 'Configure EWS' action first");
	}
	//Bind to the Mail Id provided
	EmailMessage email = EmailMessage.Bind(service, new ItemId(ID));
	if (email != null)
	{
		
		ResponseMessage response = email.CreateReply(ReplyAll);
		response.BodyPrefix = ReplyMessage;
		if(!ReplyMessage.StartsWith("<html",StringComparison.OrdinalIgnoreCase))
	    response.Body.BodyType = BodyType.Text;
		
		//Get the FolderId's of Drafts/Sent Items 
		if(SharedMailboxAddress!="")
		{
			SentItemsFolderId = new FolderId(WellKnownFolderName.SentItems,new Mailbox(SharedMailboxAddress));
			DraftsFolderId = new FolderId(WellKnownFolderName.Drafts,new Mailbox(SharedMailboxAddress));
		}
		else
		{	
			SentItemsFolderId = new FolderId(WellKnownFolderName.SentItems);
			DraftsFolderId = new FolderId(WellKnownFolderName.Drafts);
		}
		//Since attachments can't be added in Response message it is saved as an seperate mail in Drafts and attachments are added after that.
		EmailMessage reply = response.Save(DraftsFolderId);
		PropertySet properties = (BasePropertySet.FirstClassProperties);
		reply.Load(properties);
			
		//Add Additional recepients if provided in input
		if (To !="")
		{
			if(!To.EndsWith(";"))
			{
				To += ";";
			}
			foreach (EmailAddress toAddress in 	reply.ToRecipients)
			{
				 To += toAddress.Address + ";";
			}
			if(To.EndsWith(";"))
			{
				To = To.Remove(To.Length-1);
			}
			//ErrorMessage = To;
			string [] mailId = To.Split(';');
			foreach (string item in mailId)
			{
				reply.ToRecipients.Add(item.Trim());
			}

		}
		
		if (CC !="")
		{
			if(!CC.EndsWith(";"))
			{
				CC += ";";
			}
			foreach (EmailAddress toAddress in 	reply.CcRecipients)
			{
				 CC += toAddress.Address + ";";
			}
			if(CC.EndsWith(";"))
			{
				CC = CC.Remove(CC.Length-1);
			}
			string [] mailId = CC.Split(';');
			foreach (string item in mailId)
			{
				reply.CcRecipients.Add(item.ToString());
			}
			
		}
		//Add the mail attachments
		if(MailAttachments !="")
		{
			string [] attachmentItems = MailAttachments.Split(';');
		
			foreach (string item in attachmentItems)
			{
				reply.Attachments.AddFileAttachment(item.ToString());
			}
		}
		
		//For Shared Mailbox it is sent on behalf of Shared Mailbox Address
		if(SharedMailboxAddress!="")
		{
			reply.From = new EmailAddress(SharedMailboxAddress); 
		}
		reply.SendAndSaveCopy(SentItemsFolderId);
		Success =true;
	}
}
catch(Exception ex)
{
	Success =false;
	ErrorMessage = "Error in Reply Email "+ex.Message;
}
		]]></code>
  </stage>
  <stage stageid="306fa9f3-bc92-4d17-b31a-66af37d9a29d" name="flag_ReplyAll" type="Data">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <narrative>Flag for reply all</narrative>
    <displayx>-330</displayx>
    <displayy>75</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>True</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="c6778646-7051-4d66-aab5-b0a0396ceecc" name="txt_Replymessage" type="Data">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <narrative>Message text to reply</narrative>
    <displayx>-330</displayx>
    <displayy>30</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="4178f1a6-b636-4beb-b24c-db490513fdff" name="Send Email" type="SubSheetInfo">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <narrative>Sends a new mail message </narrative>
    <displayx>-360</displayx>
    <displayy>-225</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="efc80113-ac9c-4b19-9da0-d33e054209e3" name="Start" type="Start">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>-270</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Shared Mailbox" narrative="Mail address of Shared mailbox (if any)" stage="txt_SharedMailbox" />
      <input type="text" name="To" narrative="The email address to send to. If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_To" />
      <input type="text" name="CC" narrative="The email address to kept as CC. If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_CC" />
      <input type="text" name="BCC" narrative="The email address to kept as BCC. If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_BCC" />
      <input type="text" name="Subject" narrative="Subject of the mail" stage="txt_Subject" />
      <input type="text" name="Body" narrative="Mail content to be added in the body" stage="txt_Body" />
      <input type="text" name="Attachments" narrative="The attachemnts to be added(full path with file name). If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_Attachments" />
    </inputs>
    <onsuccess>01d9e06b-9404-410e-8740-fd8e049912f5</onsuccess>
  </stage>
  <stage stageid="9e497ae8-e452-4750-a0bc-21ac6b44f5cf" name="End" type="End">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Mail Sent" narrative="Flag. Mail Sent?" stage="flag_MailSent" />
      <output type="text" name="Error Message" narrative="Error message if any" stage="txt_ErrorMessage" />
    </outputs>
  </stage>
  <stage stageid="b2dd29cd-a7c8-4a28-83e8-78231fb29d73" name="txt_Subject" type="Data">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <narrative>Subject of email</narrative>
    <displayx>-510</displayx>
    <displayy>15</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="5b086c5b-1d7b-4742-96cc-7c1666fe34ef" name="txt_Body" type="Data">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <narrative>Body of email</narrative>
    <displayx>-510</displayx>
    <displayy>75</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="63a7ff4b-85b3-4f12-8576-44b92b0bbe22" name="Send Email" type="Code">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>-75</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="To" expr="[txt_To]" />
      <input type="text" name="CC" expr="[txt_CC]" />
      <input type="text" name="BCC" expr="[txt_BCC]" />
      <input type="text" name="Subject" expr="[txt_Subject]" />
      <input type="text" name="Body" expr="[txt_Body]" />
      <input type="text" name="Attachments" expr="[txt_Attachments]" />
      <input type="text" name="SharedMailboxAddress" expr="[txt_SharedMailbox]" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" stage="flag_MailSent" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
    </outputs>
    <onsuccess>f94c9b26-8872-4e46-a3c2-e71eeedff62c</onsuccess>
    <code><![CDATA[Success =true;
ErrorMessage = "";
FolderId SentItemsFolderId = null;

try
{
	//ExchangeService service = getService();
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured. Please call 'Configure EWS' action first");
	}
	
	//Create new email
	EmailMessage newEmail = new EmailMessage(service);
	//set properties
	newEmail.Body = Body;
	if(!Body.StartsWith("<html",StringComparison.OrdinalIgnoreCase))
	newEmail.Body.BodyType = BodyType.Text;
	newEmail.Subject = Subject;
	//Set To Recipients
	if (To !="")
	{
		string [] mailId = To.Split(';');
		foreach (string item in mailId)
		{
			newEmail.ToRecipients.Add(item.Trim().ToString());
		}
	}
	//Set CC Recipients
	if (CC !="")
	{
		string [] mailId = CC.Split(';');
		foreach (string item in mailId)
		{
			newEmail.CcRecipients.Add(item.Trim().ToString());
		}
	}
	//Set BCC Recipients
	if (BCC !="")
	{
		string [] mailId = BCC.Split(';');
		foreach (string item in mailId)
		{
			newEmail.BccRecipients.Add(item.Trim().ToString());
		}
	}
	//Add Attachments
	if(Attachments !="")
	{
		string [] attachmentItems = Attachments.Split(';');
		foreach (string item in attachmentItems)
		{
			newEmail.Attachments.AddFileAttachment(item.Trim().ToString());
		}
	}
	//For Shared Mailbox
	if(SharedMailboxAddress!="")
	{
		//for Shared Mailbox set Send on behalf of
		newEmail.From = new EmailAddress(SharedMailboxAddress); 
		//Get the SentItems FolderId for Shared Mailbox
		SentItemsFolderId = new FolderId(WellKnownFolderName.SentItems,new Mailbox(SharedMailboxAddress));
		//Saving it in Drafts and sending the mail.
		newEmail.Save(new FolderId(WellKnownFolderName.Drafts,new Mailbox(SharedMailboxAddress)));
		newEmail.SendAndSaveCopy(SentItemsFolderId);
	}
	//Send mail and save a copy in Sent Items
	else
	{	
		SentItemsFolderId = new FolderId(WellKnownFolderName.SentItems);
		newEmail.SendAndSaveCopy(SentItemsFolderId);
	}
	
}
catch(Exception ex)
{
	Success =false;
	ErrorMessage = "Error in Send Email: "+ ex.Message;
}
]]></code>
  </stage>
  <stage stageid="0544c06d-2df6-4432-8948-c1656163d301" name="txt_SharedMailbox" type="Data">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <narrative>Shared mailbox name</narrative>
    <displayx>-510</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="b75a52ab-f41a-4a1b-8c3e-1cf33b8f8568" name="txt_To" type="Data">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>Value in TO of email</narrative>
    <displayx>-345</displayx>
    <displayy>-105</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="64ff28df-5f95-4104-9374-3bae222f8de9" name="txt_CC" type="Data">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>Value in CC of email</narrative>
    <displayx>-345</displayx>
    <displayy>-45</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="ae7e2826-fcf8-4d17-8042-1bc215fa1e54" name="txt_BCC" type="Data">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>Value of BCC in email</narrative>
    <displayx>-345</displayx>
    <displayy>15</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="7eed1c89-c136-4d2f-93e3-06aa58579078" name="txt_Attachments" type="Data">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>Names of email attachments</narrative>
    <displayx>-510</displayx>
    <displayy>-45</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="6e4c00ad-bc39-4fc7-9665-4f509edc570c" name="txt_MemberName" type="Data">
    <subsheetid>abc8131f-23fb-4ca2-99ab-046fc33f176d</subsheetid>
    <loginhibit />
    <narrative>Member name in Distribution List</narrative>
    <displayx>-210</displayx>
    <displayy>60</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
  </stage>
  <stage stageid="5b066005-6abd-4787-bd17-09173c122c59" name="flag_IsUserInDL" type="Data">
    <subsheetid>abc8131f-23fb-4ca2-99ab-046fc33f176d</subsheetid>
    <narrative>Flag to check if user is in distribution list</narrative>
    <displayx>-180</displayx>
    <displayy>180</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="98485ea9-f5c9-41b2-b22e-72a27a0f8857" name="txt_SharedMailbox" type="Data">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <narrative>Shared mailbox folder name</narrative>
    <displayx>-315</displayx>
    <displayy>120</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="9775fe13-413e-4baa-a530-ac026fa5d5d0" name="txt_MoveToFolder" type="Data">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <narrative>Folder used to move emails</narrative>
    <displayx>-300</displayx>
    <displayy>120</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="cf468afa-3cc0-46a6-b7ca-dc8dc4fb6dd3" name="txt_MovedMailId" type="Data">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <narrative>ID of the email moved</narrative>
    <displayx>-285</displayx>
    <displayy>345</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="17ccb84c-57af-44a5-9d09-e7e567e8fca8" name="flag_MailMoved" type="Data">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <narrative>Flag to check if email is moved to the folder</narrative>
    <displayx>-285</displayx>
    <displayy>285</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="18da0213-309b-4490-8f6f-be9fd17623a6" name="Delete Email" type="SubSheetInfo">
    <subsheetid>557e45e7-d6bf-4bfd-a5b7-dbe07440f87f</subsheetid>
    <narrative>Deletes a mail based on the Unique ID provided</narrative>
    <displayx>-270</displayx>
    <displayy>-165</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="9952853a-629a-49a8-8156-0d97d880c942" name="Start" type="Start">
    <subsheetid>557e45e7-d6bf-4bfd-a5b7-dbe07440f87f</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-45</displayx>
    <displayy>-150</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="ID" narrative="The Unique ID of the mail message" stage="txt_MessageId" />
    </inputs>
    <onsuccess>711ef6e8-e0e9-4e6f-8d75-db73d1f26792</onsuccess>
  </stage>
  <stage stageid="a5b4e77f-1b21-4512-983c-630cc2d387c8" name="End" type="End">
    <subsheetid>557e45e7-d6bf-4bfd-a5b7-dbe07440f87f</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-45</displayx>
    <displayy>120</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="MailDeleted" narrative="Success or Failure of deleting mail" stage="flag_MailDeleted" />
      <output type="text" name="ErrorMessage" narrative="Error message if any" stage="txt_ErrorMessage" />
    </outputs>
  </stage>
  <stage stageid="daa1b85c-ca95-41a7-914c-d5e26de8dce3" name="Delete Mail" type="Code">
    <subsheetid>557e45e7-d6bf-4bfd-a5b7-dbe07440f87f</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-45</displayx>
    <displayy>-30</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="ID" expr="[txt_MessageId]" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" stage="flag_MailDeleted" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
    </outputs>
    <onsuccess>a5b4e77f-1b21-4512-983c-630cc2d387c8</onsuccess>
    <code><![CDATA[Success=false;
ErrorMessage="";

try
{
	//Not connected
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured.Please call 'Configure EWS' action first");
	}
	//Bind Email
	EmailMessage email = EmailMessage.Bind(service, new ItemId(ID));
	//Delete Email
	if(email!=null)
	{
		email.Delete(DeleteMode.MoveToDeletedItems);
		Success =true;
	}

}
catch(Exception ex)
{
	ErrorMessage="Error in Delete Email: "+ex.Message;
}
]]></code>
  </stage>
  <stage stageid="e918bd6f-0bf3-4094-8f7e-89f24ee04d70" name="flag_MailDeleted" type="Data">
    <subsheetid>557e45e7-d6bf-4bfd-a5b7-dbe07440f87f</subsheetid>
    <narrative>Flag to check if email is deleted</narrative>
    <displayx>-270</displayx>
    <displayy>60</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="5c147ce6-6cb0-4da9-857f-756db269e941" name="txt_MessageId" type="Data">
    <subsheetid>557e45e7-d6bf-4bfd-a5b7-dbe07440f87f</subsheetid>
    <narrative>ID of email to be deleted</narrative>
    <displayx>-255</displayx>
    <displayy>-60</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="1972ddb8-ff48-445e-b711-f5cc45ddaf2c" name="txt_ErrorMessage" type="Data">
    <subsheetid>557e45e7-d6bf-4bfd-a5b7-dbe07440f87f</subsheetid>
    <narrative>Error message</narrative>
    <displayx>-270</displayx>
    <displayy>105</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="37356484-5869-4f52-8e67-03d6d9cd8c00" name="txt_ErrorMessage" type="Data">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <narrative>Error message</narrative>
    <displayx>-285</displayx>
    <displayy>225</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="c163b90a-1ed0-47ac-8681-e5427f28a3b7" name="Get list of mails" type="Code">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-30</displayx>
    <displayy>-30</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="MailSubject" expr="[txt_MailSubject]" />
      <input type="flag" name="UnreadOnly" expr="[flag_UnreadOnly]" />
      <input type="text" name="MailFolder" expr="[txt_SubFolder]" />
      <input type="text" name="SharedMailboxAddress" expr="[txt_SharedMailbox]" />
      <input type="datetime" name="MailStartTime" expr="[dt_MailStartTime]" />
      <input type="datetime" name="MailEndTime" expr="[dt_MailEndTime]" />
    </inputs>
    <outputs>
      <output type="collection" name="Emails" stage="coll_Email" />
      <output type="flag" name="Success" stage="flag_Success" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
    </outputs>
    <onsuccess>e273285d-aaf7-4128-ae1b-7c49c4e162ff</onsuccess>
    <code><![CDATA[Success = false;
Emails = null;
ErrorMessage=null;
if(MailFolder=="")
{
	MailFolder="Inbox";
}
string MailST = MailStartTime.ToString();
string MailET = MailEndTime.ToString();

try
{
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured.Please call 'Configure EWS' action first");
	}
	
	FolderId mailFolderId = null;
	SearchFilter.SearchFilterCollection filters = new SearchFilter.SearchFilterCollection(LogicalOperator.And);
	if(UnreadOnly)
	{
		filters.Add(new SearchFilter.IsEqualTo(EmailMessageSchema.IsRead, false));
	}
	if(MailSubject!="")
	{
		filters.Add(new SearchFilter.ContainsSubstring(EmailMessageSchema.Subject, MailSubject));
	}
	filters.Add(new SearchFilter.IsGreaterThan(EmailMessageSchema.DateTimeReceived, DateTime.Parse(MailST)));
	filters.Add(new SearchFilter.IsLessThan(EmailMessageSchema.DateTimeReceived, DateTime.Parse(MailET)));
	if(SharedMailboxAddress!="")
	{
		mailFolderId = getFolderId(SharedMailboxAddress,MailFolder);
	}
	else
	{	
		mailFolderId = getFolderId(MailFolder);
	}
	List<EmailMessage> emails = getListOfMails(filters,mailFolderId);
	System.Data.DataTable emailTable = createEmailTable();
	foreach (EmailMessage email in emails)
	{
		addEmailToCollection(emailTable, email);
		
	}
	Emails = emailTable;
	Emails = emailTable;
	
	int i=0;
	i=emails.Count;
	if (i>0)
	{
		Success =true;
	}
	else
	{
		Success =false;
	}
	
	//Success =true;
}
catch(Exception ex)
{
	Success =false;
	ErrorMessage = ex.ToString();
}
]]></code>
  </stage>
  <stage stageid="042b393a-039f-47fa-87b4-10677a1d7240" name="txt_MailSubject" type="Data">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <narrative>Subject of email</narrative>
    <displayx>-240</displayx>
    <displayy>45</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="60d0c1fa-8315-4274-af54-f985bdd96e03" name="txt_SubFolder" type="Data">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <narrative>Mailbox subfolder</narrative>
    <displayx>-240</displayx>
    <displayy>0</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="13f14ee4-46e0-4332-a710-c8b4503ab206" name="flag_UnreadOnly" type="Data">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <narrative>Unread emails</narrative>
    <displayx>-330</displayx>
    <displayy>0</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="08d8536e-c35d-482c-b405-6d30b1b865c9" name="txt_SharedMailbox" type="Data">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <loginhibit />
    <narrative>Shared mailbox folder</narrative>
    <displayx>-330</displayx>
    <displayy>45</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="8a63a04a-18d4-4d9b-a9f6-08be7b589ed8" name="flag_Success" type="Data">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <narrative>Flag to check status of the processing</narrative>
    <displayx>-330</displayx>
    <displayy>270</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="0cc09ce9-fe10-4b3d-bd6d-d1e4f12b674d" name="dt_MailStartTime" type="Data">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <narrative>Start time of the email</narrative>
    <displayx>-330</displayx>
    <displayy>90</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>datetime</datatype>
    <initialvalue>2018-09-05 01:04:25Z</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="b4fd5837-6abe-433f-86d2-0f670c2544ae" name="dt_MailEndTime" type="Data">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <narrative>End time of the email</narrative>
    <displayx>-240</displayx>
    <displayy>90</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>datetime</datatype>
    <initialvalue>2021-09-05 18:04:25Z</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d1bff5fe-78cd-412a-93b8-a29d3476964b" name="txt_ErrorMessage" type="Data">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <narrative>Error message while processing emails</narrative>
    <displayx>-330</displayx>
    <displayy>225</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="161e5c1f-b2d3-46f9-a956-fab8c2369f95" name="txt_ErrorMessage" type="Data">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <narrative>Error message while processingemails</narrative>
    <displayx>-345</displayx>
    <displayy>225</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="2c4bfd8c-1b5d-49d9-a7fe-99ddfd4263f8" name="txt_ErrorMessage" type="Data">
    <subsheetid>abc8131f-23fb-4ca2-99ab-046fc33f176d</subsheetid>
    <narrative>Error message</narrative>
    <displayx>-180</displayx>
    <displayy>225</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="af3b6c28-04a6-41e2-965a-5a739ef6bc8f" name="flag_ReplySent" type="Data">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <narrative>Flag to check if reply sent</narrative>
    <displayx>-345</displayx>
    <displayy>285</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="3674cf71-b61d-4b12-acd4-810e53dd20c3" name="flag_MailSent" type="Data">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <narrative>Flag to check if email is sent</narrative>
    <displayx>-315</displayx>
    <displayy>240</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="867d362a-9075-4391-a42e-47153c74604d" name="txt_ErrorMessage" type="Data">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <narrative>Error message</narrative>
    <displayx>-315</displayx>
    <displayy>300</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="1c49aafd-9fe4-4c82-80cd-a1f61ca5ffdb" name="txt_MailAttachments" type="Data">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <loginhibit />
    <narrative>Attachments for emails</narrative>
    <displayx>-195</displayx>
    <displayy>30</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d3605997-bf2d-4b2d-b410-f5d739ae9d42" name="Get Email" type="SubSheetInfo">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Reads a mail based on the input criteria provided</narrative>
    <displayx>-315</displayx>
    <displayy>-150</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="86c45b44-5f4e-4070-8466-93563c107cdd" name="Forward Email" type="SubSheetInfo">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <narrative>Forwards the mail to the provided recipients</narrative>
    <displayx>-240</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="35d8de17-12b6-4b9a-8f37-ccdd408da6d9" name="Start" type="Start">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <loginhibit />
    <preconditions>
      <condition narrative="Configure EWS action should be executed prior to this" />
    </preconditions>
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>-120</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="MessageId" narrative="The Unique ID of the mail message" stage="txt_MessageId" />
      <input type="text" name="MailMessage" narrative="Message to added in the mail body" stage="txt_Mail body" />
      <input type="text" name="To" narrative="The email address to send to. If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_To" />
      <input type="text" name="CC" narrative="The email address to be  kept in CC. If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_CC" />
      <input type="text" name="MailAttachments" narrative="The attachemnts to be added(full path with file name). If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_MailAttachments" />
      <input type="text" name="SharedMailboxAddress" narrative="Mail address of Shared mailbox (if any)" stage="txt_SharedMailbox" />
    </inputs>
    <onsuccess>06b8f333-f2e6-4acd-a899-5b6a3be361df</onsuccess>
  </stage>
  <stage stageid="91779c5e-d946-46a0-9b47-b89d78ef746f" name="End" type="End">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>255</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="MailForwarded" narrative="Success or Failure of forwarding the mail" stage="flag_MailForwarded" />
      <output type="text" name="ErrorMessage" narrative="Error message if any" stage="txt_ErrorMessage" />
    </outputs>
  </stage>
  <stage stageid="7ce7c596-1197-40b0-801f-a78947b1ad35" name="Forward Mail" type="Code">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="ID" expr="[txt_MessageId]" />
      <input type="text" name="MailMessage" expr="[txt_Mail body]" />
      <input type="text" name="MailAttachments" expr="[txt_MailAttachments]" />
      <input type="text" name="SharedMailboxAddress" expr="[txt_SharedMailbox]" />
      <input type="text" name="To" expr="[txt_To]" />
      <input type="text" name="CC" expr="[txt_CC]" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" stage="flag_MailForwarded" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
    </outputs>
    <onsuccess>b63821b7-4223-4215-ad17-b276d3ccbac7</onsuccess>
    <code><![CDATA[Success = false;
ErrorMessage = "";
FolderId SentItemsFolderId = null;
FolderId DraftsFolderId = null;
try
{
	
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured.Please call 'Configure EWS' action first");
	}
	//Bind email
	EmailMessage email = EmailMessage.Bind(service, new ItemId(ID));
	if (email != null)
	{
		//Create response message and set properties
		ResponseMessage response = email.CreateForward();
		response.BodyPrefix = MailMessage;
		//if(!MailMessage.StartsWith("<html",StringComparison.OrdinalIgnoreCase))
	 
		//response.Body.BodyType = BodyType.Text;
		
		//Add To recipients
		if (To !="")
		{
			string [] mailId = To.Split(';');
			foreach (string item in mailId)
			{
				response.ToRecipients.Add(item.ToString());
			}
		}
		//Add CC recipients
		if (CC !="")
		{
			string [] mailId = CC.Split(';');
			foreach (string item in mailId)
			{
				response.CcRecipients.Add(item.ToString());
			}
		}
		
		
		//Get FolderId's of Sent and Drafts folder for respective mailbox
		if(SharedMailboxAddress!="")
		{
			SentItemsFolderId = new FolderId(WellKnownFolderName.SentItems,new Mailbox(SharedMailboxAddress));
			DraftsFolderId = new FolderId(WellKnownFolderName.Drafts,new Mailbox(SharedMailboxAddress));
			//forward.From = new EmailAddress(SharedMailboxAddress);
		}
		else
		{	
			SentItemsFolderId = new FolderId(WellKnownFolderName.SentItems);
			DraftsFolderId = new FolderId(WellKnownFolderName.Drafts);
		}
		//Save mail in drafts as mail message(As attachments can't be added in Response message)
		EmailMessage forward = response.Save(DraftsFolderId);
		
		if(MailAttachments !="")
		{
			string [] attachmentItems = MailAttachments.Split(';');
			
			foreach (string item in attachmentItems)
			{
				forward.Attachments.AddFileAttachment(item.ToString());
			}	
		}
		
		//For Shared Mailbox it is sent on behalf of Shared Mailbox Address
		if(SharedMailboxAddress!="")
		{
			forward.From = new EmailAddress(SharedMailboxAddress); 
		}
		
		forward.SendAndSaveCopy(SentItemsFolderId);
		Success =true;
	}	
}
catch(Exception ex)
{
	Success =false;
	ErrorMessage = "Error in Forward Mail: "+ex.ToString();
}
		]]></code>
  </stage>
  <stage stageid="22e38ebc-881e-4bb9-a473-d62319aff7a7" name="txt_Mail body" type="Data">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <narrative>Body of email</narrative>
    <displayx>-195</displayx>
    <displayy>75</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="a9069a67-dd7a-46be-8701-a8a7b3b68be3" name="txt_SharedMailbox" type="Data">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <narrative>Shared mailbox</narrative>
    <displayx>-225</displayx>
    <displayy>300</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="3151a0cd-6a1c-430e-87a0-b6f7ea2e2486" name="txt_ErrorMessage" type="Data">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <narrative>Error message</narrative>
    <displayx>-225</displayx>
    <displayy>345</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="cd0e50e2-f77f-42d4-b8c8-e7386a434559" name="txt_MailAttachments" type="Data">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <loginhibit />
    <narrative>Email attachments</narrative>
    <displayx>-195</displayx>
    <displayy>30</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="92a3ae53-4bfb-4518-8699-96d3ae3d1f08" name="txt_To" type="Data">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <narrative>Value of TO in email</narrative>
    <displayx>-195</displayx>
    <displayy>165</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="9e6a517d-bf29-401b-a4d2-b82b70ee1905" name="flag_MailForwarded" type="Data">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <narrative>Flag to check if email is forwarded</narrative>
    <displayx>-225</displayx>
    <displayy>255</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="06b8f333-f2e6-4acd-a899-5b6a3be361df" name="Is Mail Id Empty?" type="Decision">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>-60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[txt_MessageId]=&quot;&quot;" />
    <ontrue>2a783c00-0ec2-4b23-80b9-47b92886b11b</ontrue>
    <onfalse>fb554818-54dd-4545-b850-199c79426bf7</onfalse>
  </stage>
  <stage stageid="2a783c00-0ec2-4b23-80b9-47b92886b11b" name="Mail Id is empty" type="Exception">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <narrative>
    </narrative>
    <displayx>270</displayx>
    <displayy>-60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;Error in Forward Mail: Mail Id cannot be empty&quot;" />
  </stage>
  <stage stageid="711ef6e8-e0e9-4e6f-8d75-db73d1f26792" name="Is Mail Id Empty?" type="Decision">
    <subsheetid>557e45e7-d6bf-4bfd-a5b7-dbe07440f87f</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-45</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[txt_MessageId]=&quot;&quot;" />
    <ontrue>48eb5c8c-9c1d-4a9d-9200-de55ae0467fe</ontrue>
    <onfalse>daa1b85c-ca95-41a7-914c-d5e26de8dce3</onfalse>
  </stage>
  <stage stageid="48eb5c8c-9c1d-4a9d-9200-de55ae0467fe" name="Mail Id is empty" type="Exception">
    <subsheetid>557e45e7-d6bf-4bfd-a5b7-dbe07440f87f</subsheetid>
    <narrative>
    </narrative>
    <displayx>75</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;Error in Delete Email: Mail Id cannot be empty&quot;" />
  </stage>
  <stage stageid="d1a8aafc-7de5-4785-940a-ec4d72d5f326" name="Is Mail Id Empty?" type="Decision">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>-120</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[txt_MessageId]=&quot;&quot;" />
    <ontrue>50966a12-3e94-4124-a7fe-b99502178daa</ontrue>
    <onfalse>276077eb-9742-445f-ae06-df89095a2673</onfalse>
  </stage>
  <stage stageid="50966a12-3e94-4124-a7fe-b99502178daa" name="Mail Id is empty" type="Exception">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <narrative>
    </narrative>
    <displayx>315</displayx>
    <displayy>-120</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;Error in Move Email: Mail Id cannot be empty&quot;" />
  </stage>
  <stage stageid="01d9e06b-9404-410e-8740-fd8e049912f5" name="Is To Address Empty?" type="Decision">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>-210</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[txt_To]=&quot;&quot;" />
    <ontrue>33553c00-4e97-4e7b-b669-9a7aa0a9de17</ontrue>
    <onfalse>08a8cc69-7940-4429-b697-307a139ef3e5</onfalse>
  </stage>
  <stage stageid="33553c00-4e97-4e7b-b669-9a7aa0a9de17" name="To Address is empty" type="Exception">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>-210</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;To Address cannot be empty&quot;" />
  </stage>
  <stage stageid="e068bb40-a600-44c5-bcd2-2b33b4785c09" name="Is DL/Member name is empty?" type="Decision">
    <subsheetid>abc8131f-23fb-4ca2-99ab-046fc33f176d</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="([txt_DistributionListName]=&quot;&quot;)OR([txt_MemberName]=&quot;&quot;)" />
    <ontrue>a78da673-5c3a-4c5d-b611-f5627e142e6f</ontrue>
    <onfalse>c3c43f6c-6073-43ac-98c7-ee06c01b86fe</onfalse>
  </stage>
  <stage stageid="a78da673-5c3a-4c5d-b611-f5627e142e6f" name="DL/Member name is empty" type="Exception">
    <subsheetid>abc8131f-23fb-4ca2-99ab-046fc33f176d</subsheetid>
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;DL/Member name be empty&quot;" />
  </stage>
  <stage stageid="f76aca0a-8843-4a1a-a2c0-ce950ada08f5" name="Is User Credentials empty?" type="Decision">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="([txt_MailAddress]=&quot;&quot;)OR([pass_Password]=&quot;&quot;)" />
    <ontrue>40d4b4c1-ce9b-47f8-96e5-779fae00394a</ontrue>
    <onfalse>f75235da-c9c3-407f-91e3-0845a1fc8c5d</onfalse>
  </stage>
  <stage stageid="40d4b4c1-ce9b-47f8-96e5-779fae00394a" name="Credential is empty" type="Exception">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <narrative>
    </narrative>
    <displayx>255</displayx>
    <displayy>-45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;MailAddress/Password cannot be empty&quot;" />
  </stage>
  <stage stageid="c27084e1-5b69-480a-9c34-5d9ce10d94b6" name="Is Mail Id Empty?" type="Decision">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[txt_MessageId]=&quot;&quot;" />
    <ontrue>7aef5bd4-ec16-47be-83e5-203fb0280095</ontrue>
    <onfalse>559a28dd-2264-4445-a1a8-881ec0b8e43c</onfalse>
  </stage>
  <stage stageid="7aef5bd4-ec16-47be-83e5-203fb0280095" name="Mail Id is empty" type="Exception">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;Mail Id cannot be empty&quot;" />
  </stage>
  <stage stageid="d87603ee-f509-4b8e-9b75-8a1126b8e5c4" name="Is ST/ET Empty?" type="Decision">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-30</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="([dt_MailStartTime]=&quot;&quot;)OR([dt_MailEndTime]=&quot;&quot;)" />
    <ontrue>cd7c1e3f-d611-4ace-a42d-8d6dfa627946</ontrue>
    <onfalse>c163b90a-1ed0-47ac-8681-e5427f28a3b7</onfalse>
  </stage>
  <stage stageid="cd7c1e3f-d611-4ace-a42d-8d6dfa627946" name="Mail Start/End Time is null" type="Exception">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;Mail Start/End Time cannot be empty&quot;" />
  </stage>
  <stage stageid="12db16d8-e8aa-4c26-992f-c74f6226aafb" name="txt_To" type="Data">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <loginhibit />
    <narrative>Value for TO in email</narrative>
    <displayx>-195</displayx>
    <displayy>75</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="8ef28fe1-114a-4ce2-82c1-c9b884904ccb" name="txt_CC" type="Data">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <loginhibit />
    <narrative>CC values for email</narrative>
    <displayx>-195</displayx>
    <displayy>-15</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="76515320-5f88-4e35-8326-141005fb6aaf" name="txt_CC" type="Data">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <loginhibit />
    <narrative>Value of CC in email</narrative>
    <displayx>-195</displayx>
    <displayy>120</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="02aed352-d41e-4382-b0c6-e0113bd480c3" name="txt_ErrorMessage" type="Data">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <narrative>Error message</narrative>
    <displayx>-210</displayx>
    <displayy>165</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="7e34d342-b197-4ae3-a7f6-cfa8949a14b3" name="flag_Configured" type="Data">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <narrative>Flag to check if mailbox is configured</narrative>
    <displayx>-210</displayx>
    <displayy>210</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="1ae809a6-5d97-463d-a65a-bd756ad6cee1" name="txt_SharedMailbox" type="Data">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <narrative>Shared mailbox</narrative>
    <displayx>-210</displayx>
    <displayy>75</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="6be22c40-fd06-4214-afbc-36374f31a295" name="Save Email" type="SubSheetInfo">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>Save email as .eml file</narrative>
    <displayx>-285</displayx>
    <displayy>-90</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="c67a111b-7b84-45d1-859d-c7d3f842122a" name="Start" type="Start">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>-15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="ID" narrative="Unique ID of the mail message" stage="txt_MessageId" />
      <input type="text" name="File Directory" narrative="Folder on computer or network where any attachments should be saved to" stage="txt_FileDirectory" />
      <input type="text" name="File Name" narrative="File Name of the mail message" stage="txt_FileName" />
    </inputs>
    <onsuccess>02c9b75f-2f9f-48ee-b460-be4d01417f89</onsuccess>
  </stage>
  <stage stageid="f5824718-ea58-4e56-88c9-960c78f4292f" name="End" type="End">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>315</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="text" name="FilePath" stage="txt_FilePath" />
    </outputs>
  </stage>
  <stage stageid="f06c2ce9-ecb5-44bb-91a3-5ffec135fbe3" name="Save email" type="Code">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>210</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="ID" expr="[txt_MessageId]" />
      <input type="text" name="FileName" expr="[txt_FileName]" />
      <input type="text" name="FileDirectory" expr="[txt_FileDirectory]" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" stage="flag_MailSaved" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
      <output type="text" name="FilePath" stage="txt_FilePath" />
    </outputs>
    <onsuccess>ae49f1ff-f651-4dd0-8423-d2dc0537cab8</onsuccess>
    <code><![CDATA[Success=false;
ErrorMessage="";
FilePath="";
try
{
	
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured.Please call 'Configure EWS' action first");
	}
	//Bind email
	EmailMessage email = EmailMessage.Bind(service, new ItemId(ID));

	if(email!=null)
	{
		//Add Backlash if not available
		if(!FileDirectory.EndsWith(@"\"))
		{
				FileDirectory+=@"\";
		}
		//Get Mail content
		email.Load(new PropertySet(ItemSchema.MimeContent));
		MimeContent mc = email.MimeContent;
		//Save mail in .eml format
		using(FileStream fs = new FileStream(@FileDirectory+FileName+".eml", FileMode.Create))
		{
			fs.Write(mc.Content, 0, mc.Content.Length);
			fs.Close();
			FilePath=@FileDirectory+FileName+".eml";
			Success =true;
		}
	}
}
catch(Exception ex)
{
	Success =false;
	ErrorMessage="Error in Save Email: "+ex.Message;
}
]]></code>
  </stage>
  <stage stageid="be6c03f6-7e1d-4973-a176-20c2ac84b9bb" name="txt_ErrorMessage" type="Data">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>Error message</narrative>
    <displayx>-270</displayx>
    <displayy>240</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="3079a4fe-d4a3-4e91-bacc-f8ce43bab709" name="txt_FileDirectory" type="Data">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>Folder path on which email is being saved</narrative>
    <displayx>-255</displayx>
    <displayy>45</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="9ae320b2-4bef-4fc8-833b-d2c6158ccc21" name="txt_FileName" type="Data">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>Name of email file to be saved</narrative>
    <displayx>-255</displayx>
    <displayy>105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="22a2f98d-3f46-4916-82ef-41812e1e4789" name="flag_MailSaved" type="Data">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>Flag to check if email is saved</narrative>
    <displayx>-270</displayx>
    <displayy>300</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="0be27a3c-1109-43ef-a886-5dc38915395b" name="txt_FilePath" type="Data">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>Path of email to be saved</narrative>
    <displayx>-270</displayx>
    <displayy>360</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="aea8b33f-1e97-4c20-9341-8a83f0cad2f2" name="txt_MessageId" type="Data">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <narrative>ID of email to be forwarded</narrative>
    <displayx>-195</displayx>
    <displayy>-15</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="549fc3c0-af27-431b-9006-05a6c6a7c605" name="txt_MessageId" type="Data">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <narrative>ID for email message</narrative>
    <displayx>-300</displayx>
    <displayy>0</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="e0a8c3c1-6593-4233-8189-2e39c34975a7" name="txt_MessageId" type="Data">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <narrative>ID generated for the email message</narrative>
    <displayx>-330</displayx>
    <displayy>-15</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="8d5c388e-e252-4cdc-b9f7-b25ffbf666c2" name="txt_MessageId" type="Data">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>ID of email to be saved</narrative>
    <displayx>-255</displayx>
    <displayy>0</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="86328459-b009-425c-931b-f5e80a5f3434" name="Get Contacts" type="SubSheetInfo">
    <subsheetid>61d804a6-447d-4e08-ac90-db41c3ea1a93</subsheetid>
    <narrative>Retrieve Contacts based on Search string</narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="3697c6f9-7284-4ff7-ad47-bff2db2cc46e" name="Start" type="Start">
    <subsheetid>61d804a6-447d-4e08-ac90-db41c3ea1a93</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Search Text" stage="txt_SearchText" />
    </inputs>
    <onsuccess>422fd702-5df3-4772-bac0-462a17cf11e3</onsuccess>
  </stage>
  <stage stageid="b11b6223-e634-4402-a48f-86e76e50da46" name="End" type="End">
    <subsheetid>61d804a6-447d-4e08-ac90-db41c3ea1a93</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="collection" name="Contacts" stage="coll_Contacts" />
      <output type="flag" name="FoundMatch" stage="flag_FoundMatch" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
    </outputs>
  </stage>
  <stage stageid="422fd702-5df3-4772-bac0-462a17cf11e3" name="Get Contacts" type="Code">
    <subsheetid>61d804a6-447d-4e08-ac90-db41c3ea1a93</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>15</displayx>
    <displayy>-15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="SearchText" expr="[txt_SearchText]" />
    </inputs>
    <outputs>
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
      <output type="collection" name="Contacts" stage="coll_Contacts" />
      <output type="flag" name="FoundMatch" stage="flag_FoundMatch" />
    </outputs>
    <onsuccess>b11b6223-e634-4402-a48f-86e76e50da46</onsuccess>
    <code><![CDATA[Contacts= null;ErrorMessage="";FoundMatch=false;

    System.Data.DataTable contacts = new System.Data.DataTable();
    contacts.Columns.Add("DisplayName", typeof(String));
    contacts.Columns.Add("Department", typeof(String));
    contacts.Columns.Add("EmailAddresses", typeof(String));
    contacts.Columns.Add("JobTitle", typeof(String));
    contacts.Columns.Add("PhoneNumber", typeof(String));
contacts.Columns.Add("OfficeLocation", typeof(String));


NameResolutionCollection results = service.ResolveName(SearchText,ResolveNameSearchLocation.ContactsThenDirectory,true);
if(results.Count>0)
{
	FoundMatch=true;
	foreach (var item in results)
	{
		System.Data.DataRow newRow = contacts.NewRow();
		newRow.ItemArray = new Object[] {item.Contact.DisplayName.ToString(),item.Contact.Department,item.Mailbox.Address,item.Contact.JobTitle,item.Contact.PhoneNumbers[PhoneNumberKey.BusinessPhone],item.Contact.OfficeLocation };
		contacts.Rows.Add(newRow);
	}
	Contacts = contacts;
}
else
{
FoundMatch=false;
ErrorMessage="No Match found";
}]]></code>
  </stage>
  <stage stageid="2795c18f-342b-4694-b470-4289d89b3660" name="txt_SearchText" type="Data">
    <subsheetid>61d804a6-447d-4e08-ac90-db41c3ea1a93</subsheetid>
    <narrative>String to be searched in email</narrative>
    <displayx>-225</displayx>
    <displayy>-15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="3378b199-3de4-471a-8736-abdbb9f8ed5d" name="txt_ErrorMessage" type="Data">
    <subsheetid>61d804a6-447d-4e08-ac90-db41c3ea1a93</subsheetid>
    <narrative>Error message</narrative>
    <displayx>-225</displayx>
    <displayy>195</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="6baa0ff6-7378-4107-baf0-9010e8ffddc3" name="coll_Contacts" type="Collection">
    <subsheetid>61d804a6-447d-4e08-ac90-db41c3ea1a93</subsheetid>
    <narrative>List of all contacts</narrative>
    <displayx>-225</displayx>
    <displayy>105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>collection</datatype>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="4a35ce8e-a2b8-4f47-8e42-ec6b49cc054c" name="flag_FoundMatch" type="Data">
    <subsheetid>61d804a6-447d-4e08-ac90-db41c3ea1a93</subsheetid>
    <narrative>Flag to check if match is found</narrative>
    <displayx>-225</displayx>
    <displayy>150</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="881abb1f-8483-4970-9206-24587d701868" name="Get Email By UniqueID" type="SubSheetInfo">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>Gets email by unique message ID</narrative>
    <displayx>-345</displayx>
    <displayy>-135</displayy>
    <displaywidth>180</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="67ca91cf-8ca3-4750-bd0a-8ea96994762c" name="Start" type="Start">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>-120</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Attachment Directory" narrative="Optional. Folder on computer or network where any attachments should be saved to.  If not set than attachments will be ignored" stage="txt_AttachmentDirectory" />
      <input type="text" name="MailUniqueId" narrative="Mandatory , Mail Unique ID" stage="txt_MailUniqueId" />
    </inputs>
    <onsuccess>55675306-dcee-40f2-99fe-0192b8bd74d3</onsuccess>
  </stage>
  <stage stageid="ee6358ef-85e7-4eb1-a6e0-0630492218d3" name="End" type="End">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>225</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="text" name="SenderName" narrative="Name of the mail Sender" stage="txt_SenderName" />
      <output type="text" name="SenderMailAddress" narrative="Mail address of the Sender" stage="txt_SenderMailAddress" />
      <output type="text" name="Subject" narrative="The Subject of the Mail" stage="txt_MailSubject" />
      <output type="text" name="MailBody" narrative="The Body of the message" stage="txt_MailBody" />
      <output type="text" name="To" narrative="Mail Recipients in the To seperated by Semicolon" stage="txt_To" />
      <output type="text" name="CC" narrative="Mail Recipients in the CC seperated by Semicolon" stage="txt_CC" />
      <output type="datetime" name="MailSentTime" narrative="Mail Sent Time" stage="dt_MailSentTime" />
      <output type="datetime" name="MailReceivedTime" narrative="Mail Received Time" stage="dt_MailReceivedTime" />
      <output type="number" name="AttachmentCount" narrative="Attachment Count" stage="num_AttachmentCount" />
      <output type="text" name="AttachmentNames" narrative="Names of the Attachment separated by semicolon " stage="txt_AttachmentNames" />
      <output type="flag" name="GotMail" narrative="Flag. Got any mail" stage="flag_GotMail" />
      <output type="text" name="ErrorMessage" narrative="Error message if any" stage="txt_ErrorMessage" />
    </outputs>
  </stage>
  <stage stageid="c5ff881b-240d-4128-bc39-0c3b44df4dcd" name="flag_GotMail" type="Data">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>Flag to check if received email</narrative>
    <displayx>-465</displayx>
    <displayy>360</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="f9fbb8e2-b48d-46b0-8a77-17cb3555ca75" name="txt_AttachmentDirectory" type="Data">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>Folder for downloading email attachments</narrative>
    <displayx>-540</displayx>
    <displayy>45</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="06e51998-c228-45d0-a172-567ef3be9569" name="txt_ErrorMessage" type="Data">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>Error Message</narrative>
    <displayx>-465</displayx>
    <displayy>540</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="c44c0374-2d55-43ab-8155-c626357d41b8" name="txt_SenderName" type="Data">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>Sender name</narrative>
    <displayx>-555</displayx>
    <displayy>360</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="6964f494-2a9f-4a27-8372-ad12e592f88e" name="txt_SenderMailAddress" type="Data">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>Email ID value for sender</narrative>
    <displayx>-555</displayx>
    <displayy>450</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="5e017361-2c30-4320-ab84-540cc4b3bcb9" name="txt_MailBody" type="Data">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>Email body</narrative>
    <displayx>-555</displayx>
    <displayy>405</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="76945b79-b7bc-4483-83a8-b4d154d6a307" name="txt_AttachmentNames" type="Data">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>Name of the email attachment</narrative>
    <displayx>-555</displayx>
    <displayy>540</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="4dec5c56-3ca7-409f-9ee8-898c6fe932bc" name="txt_To" type="Data">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>Value for TO addresses in email</narrative>
    <displayx>-465</displayx>
    <displayy>315</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="998478d9-bd7f-4c73-926c-12003c3b9fd0" name="txt_CC" type="Data">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>Value for CC in email</narrative>
    <displayx>-465</displayx>
    <displayy>405</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="28366b5f-b351-4e3d-bc7e-43f2497f82c5" name="txt_MailUniqueId" type="Data">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>ID generated for emails</narrative>
    <displayx>-540</displayx>
    <displayy>-15</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d4d1dfd0-2e65-46a5-a11d-1a56a2d4881c" name="dt_MailSentTime" type="Data">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>Send time for email</narrative>
    <displayx>-555</displayx>
    <displayy>495</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>datetime</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="860da705-fcaa-4d48-8422-00496c502f79" name="dt_MailReceivedTime" type="Data">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>Received time of email</narrative>
    <displayx>-465</displayx>
    <displayy>495</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>datetime</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="031b4ff2-abfa-4e01-a0ec-1f53c67e5e67" name="txt_MailSubject" type="Data">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>Email subject</narrative>
    <displayx>-465</displayx>
    <displayy>450</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d1a5d944-a1f1-4a88-85e8-5a7a641d460e" name="num_AttachmentCount" type="Data">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>Count of email attachments</narrative>
    <displayx>-555</displayx>
    <displayy>315</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="c9d871b8-66b5-4ce1-abde-dc775aa8536c" name="Is Mail Id Empty?" type="Decision">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[txt_MailUniqueId]=&quot;&quot;" />
    <ontrue>84dec961-50d0-4446-b966-9183475554c1</ontrue>
    <onfalse>eb7b87e8-4c07-4ca2-b3a6-ee7054f019d0</onfalse>
  </stage>
  <stage stageid="84dec961-50d0-4446-b966-9183475554c1" name="Mail Unique Id is empty" type="Exception">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;Error in Get Email By ID : Mail Unique Id cannot be empty&quot;" />
  </stage>
  <stage stageid="34b0b5bf-68a3-4ff7-b8f6-79c97d8da571" name="Input data Items" type="Block">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>
    </narrative>
    <displayx>-615</displayx>
    <displayy>-75</displayy>
    <displaywidth>165</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="c2289578-8c82-4f71-8f03-ecdff30564f3" name="Output data Items" type="Block">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>
    </narrative>
    <displayx>-615</displayx>
    <displayy>90</displayy>
    <displaywidth>165</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="ff996899-64a2-45c3-a342-e19e96bda78f" name="Local data Items" type="Block">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>
    </narrative>
    <displayx>-615</displayx>
    <displayy>270</displayy>
    <displaywidth>225</displaywidth>
    <displayheight>360</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="0000FF" />
  </stage>
  <stage stageid="b3ec35c1-da50-41d1-873e-e1d0529c65c5" name="Global data Items" type="Block">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>
    </narrative>
    <displayx>-420</displayx>
    <displayy>-75</displayy>
    <displaywidth>165</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF6600" />
  </stage>
  <stage stageid="f3b53810-59ef-4a69-af45-8fd683437776" name="Environmental data Items" type="Block">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>
    </narrative>
    <displayx>-420</displayx>
    <displayy>90</displayy>
    <displaywidth>165</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FFFF00" />
  </stage>
  <stage stageid="78bc75ce-0f5c-4be5-a787-47535d0a7775" name="Mark Email as ReadOrUnRead" type="SubSheetInfo">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <narrative>To Mark email as Read or Unread</narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="e8e7a39e-839c-40f2-a677-daab09bcc47d" name="Start" type="Start">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>-120</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="MailUniqueId" narrative="Mandatory , Mail Unique ID" stage="txt_MailUniqueId" />
      <input type="flag" name="IsRead" narrative="Mandatory , IsRead = True marks the email as Read , IsRead = False marks the email as Unread" stage="flag_IsRead" />
    </inputs>
    <onsuccess>e4d95e80-f670-4871-976f-f1a6c23377f9</onsuccess>
  </stage>
  <stage stageid="342ad013-4186-43a5-a613-37509f7a4c40" name="End" type="End">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>225</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Success" narrative="Flag. Got any mail" stage="flag_Success" />
      <output type="text" name="ErrorMessage" narrative="Error message if any" stage="txt_ErrorMessage" />
    </outputs>
  </stage>
  <stage stageid="b72f8aef-ec8e-4291-8f87-7d1d98e4a6e1" name="Mark email as read / unread" type="Code">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="MailUniqueId" expr="[txt_MailUniqueId]" />
      <input type="flag" name="IsRead" expr="[flag_IsRead]" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" stage="flag_Success" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
    </outputs>
    <onsuccess>705adead-c574-44bc-b31d-507ea0e90045</onsuccess>
    <code><![CDATA[Success = false;
ErrorMessage ="";



try
{
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured.Please call 'Configure EWS' action first");
	}

		//Bind email
	EmailMessage email = EmailMessage.Bind(service, new ItemId(MailUniqueId));

	if(email!=null)
	{
		email.IsRead = IsRead;
		email.Update(ConflictResolutionMode.AutoResolve);
		
		Success =true;
		
	}
	else
	{
		Success =false;
	ErrorMessage = "Email not found";

		}
}
catch(Exception ex)
{
	Success =false;
	ErrorMessage = "Error in Get Email: "+ex.Message;
}]]></code>
  </stage>
  <stage stageid="e4d95e80-f670-4871-976f-f1a6c23377f9" name="Is Mail Id Empty?" type="Decision">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>-60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[txt_MailUniqueId]=&quot;&quot;" />
    <ontrue>e2f7053e-a793-4f57-86bd-1b93ac042f05</ontrue>
    <onfalse>4d58ba73-173e-4764-ab07-b175387e0c26</onfalse>
  </stage>
  <stage stageid="e2f7053e-a793-4f57-86bd-1b93ac042f05" name="Mail Unique Id is empty" type="Exception">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <narrative>
    </narrative>
    <displayx>285</displayx>
    <displayy>-60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;Error in mark email as Read Or Unread : Mail Unique Id cannot be empty&quot;" />
  </stage>
  <stage stageid="ee747eba-e526-4eb8-90b4-a73c09a3ff6c" name="txt_MailUniqueId" type="Data">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <narrative>Unique ID generated for emails</narrative>
    <displayx>-210</displayx>
    <displayy>0</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="ec63c8dc-6d10-4556-a8f4-f38a231bc74f" name="flag_IsRead" type="Data">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <narrative>Flag to check if email is read</narrative>
    <displayx>-210</displayx>
    <displayy>45</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="e111bda2-a11b-41f9-a74f-281b2df62c71" name="flag_Success" type="Data">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <narrative>Success check flag</narrative>
    <displayx>-210</displayx>
    <displayy>210</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d862b45c-8bdb-4adc-a514-8e6ce50476e5" name="txt_ErrorMessage" type="Data">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <narrative>Error message</narrative>
    <displayx>-210</displayx>
    <displayy>255</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="e4d0382e-f437-4bfd-9518-ddb05e087cda" name="Input data Items" type="Block">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <narrative>
    </narrative>
    <displayx>-270</displayx>
    <displayy>-45</displayy>
    <displaywidth>165</displaywidth>
    <displayheight>195</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="d976c51b-d95e-46af-94c1-0bde0bb847b7" name="Output data Items" type="Block">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <narrative>
    </narrative>
    <displayx>-270</displayx>
    <displayy>165</displayy>
    <displaywidth>165</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="a6bbe52e-a7f6-4003-a3e4-955f66373e35" name="Get Email ReadOrUnread Status" type="SubSheetInfo">
    <subsheetid>f355daca-fdc3-4bca-870b-8f3f5ca4e1c1</subsheetid>
    <narrative>Get status of email - Read or Unread</narrative>
    <displayx>-195</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="f5e95e4a-38d6-496b-b4ac-77ee31f62e7d" name="Start" type="Start">
    <subsheetid>f355daca-fdc3-4bca-870b-8f3f5ca4e1c1</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="MailUniqueId" narrative="Mandatory , Mail Unique ID" stage="txt_MailUniqueId" />
      <input type="flag" name="IsRead" narrative="Mandatory , IsRead = True marks the email as Read , IsRead = False marks the email as Unread" stage="flag_IsRead" />
    </inputs>
    <onsuccess>cb098722-d5cb-4251-9eee-015796242045</onsuccess>
  </stage>
  <stage stageid="db595807-8d7e-4411-8db1-12a7bde9484a" name="End" type="End">
    <subsheetid>f355daca-fdc3-4bca-870b-8f3f5ca4e1c1</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>75</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="Success" narrative="Flag. Got any mail" stage="flag_Success" />
      <output type="text" name="ErrorMessage" narrative="Error message if any" stage="txt_ErrorMessage" />
      <output type="flag" name="IsRead" narrative="IsRead = True means the email is Read , IsRead = False marks the email is Unread" stage="flag_IsRead" />
    </outputs>
  </stage>
  <stage stageid="e513d336-8e8c-4812-bda1-7134f1f9a3d4" name="Get email read / unread status" type="Code">
    <subsheetid>f355daca-fdc3-4bca-870b-8f3f5ca4e1c1</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="MailUniqueId" expr="[txt_MailUniqueId]" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" stage="flag_Success" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
      <output type="flag" name="IsRead" stage="flag_IsRead" />
    </outputs>
    <onsuccess>db595807-8d7e-4411-8db1-12a7bde9484a</onsuccess>
    <code><![CDATA[Success = false;
ErrorMessage ="";
IsRead = false;

//Item mailItem =null;
//EmailMessage mailMessage = null;


try
{
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured.Please call 'Configure EWS' action first");
	}

		//Bind email
	EmailMessage email = EmailMessage.Bind(service, new ItemId(MailUniqueId));

	if(email!=null)
	{
		IsRead = email.IsRead;
		//email.Update(ConflictResolutionMode.AutoResolve);
		
		Success =true;
		
	}
	else
	{
		Success =false;
	ErrorMessage = "Email not found";

		}
}
catch(Exception ex)
{
	Success =false;
	ErrorMessage = "Error in Get Email: "+ex.Message;
}]]></code>
  </stage>
  <stage stageid="cb098722-d5cb-4251-9eee-015796242045" name="Is Mail Id Empty?" type="Decision">
    <subsheetid>f355daca-fdc3-4bca-870b-8f3f5ca4e1c1</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>-30</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[txt_MailUniqueId]=&quot;&quot;" />
    <ontrue>e577023a-00e8-426f-83ba-376c93df2d0a</ontrue>
    <onfalse>e513d336-8e8c-4812-bda1-7134f1f9a3d4</onfalse>
  </stage>
  <stage stageid="e577023a-00e8-426f-83ba-376c93df2d0a" name="Mail Unique Id is empty" type="Exception">
    <subsheetid>f355daca-fdc3-4bca-870b-8f3f5ca4e1c1</subsheetid>
    <narrative>
    </narrative>
    <displayx>225</displayx>
    <displayy>-30</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;Error in Get Email ReadOrUnread Status : Mail Unique Id cannot be empty&quot;" />
  </stage>
  <stage stageid="b1b26e35-4e77-42dc-98c4-1e599cb60a49" name="txt_MailUniqueId" type="Data">
    <subsheetid>f355daca-fdc3-4bca-870b-8f3f5ca4e1c1</subsheetid>
    <narrative>Unique email ID</narrative>
    <displayx>-210</displayx>
    <displayy>15</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="ba2b0b0d-bb8d-4a62-a15b-eed06e89c63a" name="flag_IsRead" type="Data">
    <subsheetid>f355daca-fdc3-4bca-870b-8f3f5ca4e1c1</subsheetid>
    <narrative>Flag to check if email is unread</narrative>
    <displayx>-210</displayx>
    <displayy>225</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="4c1b039b-b2c8-4077-b549-888b4fa15c7e" name="flag_Success" type="Data">
    <subsheetid>f355daca-fdc3-4bca-870b-8f3f5ca4e1c1</subsheetid>
    <narrative>Success check flag</narrative>
    <displayx>-210</displayx>
    <displayy>135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="c2dd3be3-ca6c-4fee-bd24-ba40c55fdc2d" name="txt_ErrorMessage" type="Data">
    <subsheetid>f355daca-fdc3-4bca-870b-8f3f5ca4e1c1</subsheetid>
    <narrative>Error message</narrative>
    <displayx>-210</displayx>
    <displayy>180</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="36c0a84a-5922-4b00-ada0-8a2de5d9cbff" name="Input data Items" type="Block">
    <subsheetid>f355daca-fdc3-4bca-870b-8f3f5ca4e1c1</subsheetid>
    <narrative>
    </narrative>
    <displayx>-270</displayx>
    <displayy>-30</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>105</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="091ac8d5-68a4-4d12-a194-36858c2d22e9" name="Output data Items" type="Block">
    <subsheetid>f355daca-fdc3-4bca-870b-8f3f5ca4e1c1</subsheetid>
    <narrative>
    </narrative>
    <displayx>-270</displayx>
    <displayy>90</displayy>
    <displaywidth>180</displaywidth>
    <displayheight>180</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="eaa6fea3-0936-4de2-a3ed-9e919acad92a" name="Output Data Items" type="Block">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-405</displayx>
    <displayy>150</displayy>
    <displaywidth>225</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="5ac0bc7f-7e72-4fd1-870e-94ad53113604" name="Input Data Items" type="Block">
    <subsheetid>9fea642b-bef0-47db-8111-3c798959b161</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-405</displayx>
    <displayy>-30</displayy>
    <displaywidth>225</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="f1388848-9dca-43b1-a51c-46df47179ef8" name="Input Data Items" type="Block">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-405</displayx>
    <displayy>-45</displayy>
    <displaywidth>315</displaywidth>
    <displayheight>195</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="574ea26c-10ef-4ef5-bce9-0c198edb0572" name="Output Data Items" type="Block">
    <subsheetid>0a017ee4-af96-44fa-8356-8c20e92a3f48</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-405</displayx>
    <displayy>165</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>195</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="8884d120-6fe6-41f0-b94d-b2019cfa7be9" name="Input Data Items" type="Block">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-270</displayx>
    <displayy>-45</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="e1025068-f6b3-48fa-b2a8-76230c70fb50" name="Output Data Items" type="Block">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-270</displayx>
    <displayy>120</displayy>
    <displaywidth>105</displaywidth>
    <displayheight>165</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="8f3d4ec3-7316-4c3d-acc4-88b34e3fc06c" name="Input Data Items" type="Block">
    <subsheetid>abc8131f-23fb-4ca2-99ab-046fc33f176d</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-270</displayx>
    <displayy>-30</displayy>
    <displaywidth>135</displaywidth>
    <displayheight>135</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="21e3e43e-1822-48f4-a21d-27411bb33e33" name="Output Data Items" type="Block">
    <subsheetid>abc8131f-23fb-4ca2-99ab-046fc33f176d</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-270</displayx>
    <displayy>135</displayy>
    <displaywidth>165</displaywidth>
    <displayheight>195</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="146fed1c-257f-4c15-b153-d3c3f063e5ec" name="Input Data Items" type="Block">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-630</displayx>
    <displayy>-150</displayy>
    <displaywidth>345</displaywidth>
    <displayheight>255</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="01b05870-2d4a-438e-9c2f-de0dcbdc387e" name="Output Data Items" type="Block">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-405</displayx>
    <displayy>195</displayy>
    <displaywidth>210</displaywidth>
    <displayheight>195</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="e84f4e40-356f-4436-adcd-f6eaf7fd96af" name="Input Data Items" type="Block">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-375</displayx>
    <displayy>-45</displayy>
    <displaywidth>180</displaywidth>
    <displayheight>210</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="adecee53-1902-4576-886f-d643cf754dcf" name="Output Data Items" type="Block">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-375</displayx>
    <displayy>180</displayy>
    <displaywidth>180</displaywidth>
    <displayheight>210</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="77f7be7f-903c-4ecd-993f-6eac3c7c8661" name="Output Data Items" type="Block">
    <subsheetid>557e45e7-d6bf-4bfd-a5b7-dbe07440f87f</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-345</displayx>
    <displayy>15</displayy>
    <displaywidth>210</displaywidth>
    <displayheight>120</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="b878feb6-b2ac-486d-b9ba-b58a54b0ef7c" name="Input Data Items" type="Block">
    <subsheetid>557e45e7-d6bf-4bfd-a5b7-dbe07440f87f</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-345</displayx>
    <displayy>-90</displayy>
    <displaywidth>210</displaywidth>
    <displayheight>75</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="61583b8b-b7d2-4d57-94f9-3b0cccfe1b8b" name="Input Data Items" type="Block">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-315</displayx>
    <displayy>-45</displayy>
    <displaywidth>240</displaywidth>
    <displayheight>240</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="8c0e69dc-304e-4e32-9ca1-3d0b37e0baf8" name="Output Data Items" type="Block">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-315</displayx>
    <displayy>210</displayy>
    <displaywidth>180</displaywidth>
    <displayheight>210</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="d4ba5016-c491-4540-9590-7b59e6241f98" name="Input Data Items" type="Block">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-360</displayx>
    <displayy>-30</displayy>
    <displaywidth>225</displaywidth>
    <displayheight>195</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="6b46eb10-4274-46a4-842d-1fe8b872835c" name="Output Data Items" type="Block">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-360</displayx>
    <displayy>195</displayy>
    <displaywidth>180</displaywidth>
    <displayheight>210</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="7f352f5c-b1e3-4f96-85fc-ed86f768133c" name="Input Data Items" type="Block">
    <subsheetid>61d804a6-447d-4e08-ac90-db41c3ea1a93</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-270</displayx>
    <displayy>-45</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>75</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="d694517a-9f6d-45f3-870a-09ebbf42825b" name="Output Data Items" type="Block">
    <subsheetid>61d804a6-447d-4e08-ac90-db41c3ea1a93</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-270</displayx>
    <displayy>60</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>195</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="86ee343c-83f7-4c02-811f-e2d7f226b2dd" name="Forward Email Special" type="SubSheetInfo">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <narrative>Forwards the email when email is in shared mailbox and sender is parent mailbox</narrative>
    <displayx>-240</displayx>
    <displayy>-105</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="38ec8312-9190-463e-8603-30dc03bb0fd1" name="Start" type="Start">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <loginhibit />
    <preconditions>
      <condition narrative="Configure EWS action should be executed prior to this" />
    </preconditions>
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>-60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="MessageId" narrative="The Unique ID of the mail message" stage="txt_MessageId" />
      <input type="text" name="MailMessage" narrative="Message to added in the mail body" stage="txt_Mail body" />
      <input type="text" name="To" narrative="The email address to send to. If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_To" />
      <input type="text" name="CC" narrative="The email address to be  kept in CC. If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_CC" />
      <input type="text" name="MailAttachments" narrative="The attachemnts to be added(full path with file name). If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_MailAttachments" />
      <input type="text" name="SharedMailboxAddress" narrative="Mail address of Shared mailbox (if any)" stage="txt_SharedMailbox" />
    </inputs>
    <onsuccess>4eb2ecbb-0e1b-456c-87db-524d0f595343</onsuccess>
  </stage>
  <stage stageid="865756ce-e58e-4d3a-9055-6fe296cdc98a" name="End" type="End">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>270</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="MailForwarded" narrative="Success or Failure of forwarding the mail" stage="flag_MailForwarded" />
      <output type="text" name="ErrorMessage" narrative="Error message if any" stage="txt_ErrorMessage" />
    </outputs>
  </stage>
  <stage stageid="93b6c766-baf0-43b7-b078-c51a2c822b14" name="Forward Mail2" type="Code">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>165</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="ID" expr="[txt_MessageId]" />
      <input type="text" name="MailMessage" expr="[txt_Mail body]" />
      <input type="text" name="MailAttachments" expr="[txt_MailAttachments]" />
      <input type="text" name="SharedMailboxAddress" expr="[txt_SharedMailbox]" />
      <input type="text" name="To" expr="[txt_To]" />
      <input type="text" name="CC" expr="[txt_CC]" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" stage="flag_MailForwarded" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
    </outputs>
    <onsuccess>915b3de5-6623-459b-9718-be105d34d9e9</onsuccess>
    <code><![CDATA[Success = false;
ErrorMessage = "";
FolderId SentItemsFolderId = null;
FolderId DraftsFolderId = null;
try
{
	
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured.Please call 'Configure EWS' action first");
	}
	//Bind email
	EmailMessage email = EmailMessage.Bind(service, new ItemId(ID));
	if (email != null)
	{
		//Create response message and set properties
		ResponseMessage response = email.CreateForward();
		response.BodyPrefix = MailMessage;
		//if(!MailMessage.StartsWith("<html",StringComparison.OrdinalIgnoreCase))
	 
		//response.Body.BodyType = BodyType.Text;
		
		//Add To recipients
		if (To !="")
		{
			string [] mailId = To.Split(';');
			foreach (string item in mailId)
			{
				response.ToRecipients.Add(item.ToString());
			}
		}
		//Add CC recipients
		if (CC !="")
		{
			string [] mailId = CC.Split(';');
			foreach (string item in mailId)
			{
				response.CcRecipients.Add(item.ToString());
			}
		}
		
		SharedMailboxAddress = "";
		//Get FolderId's of Sent and Drafts folder for respective mailbox
		if(SharedMailboxAddress!="")
		{
			SentItemsFolderId = new FolderId(WellKnownFolderName.SentItems,new Mailbox(SharedMailboxAddress));
			DraftsFolderId = new FolderId(WellKnownFolderName.Drafts,new Mailbox(SharedMailboxAddress));
			//forward.From = new EmailAddress(SharedMailboxAddress);
		}
		else
		{	
			SentItemsFolderId = new FolderId(WellKnownFolderName.SentItems);
			DraftsFolderId = new FolderId(WellKnownFolderName.Drafts);
		}
		//Save mail in drafts as mail message(As attachments can't be added in Response message)
		EmailMessage forward = response.Save(DraftsFolderId);
		
		if(MailAttachments !="")
		{
			string [] attachmentItems = MailAttachments.Split(';');
			
			foreach (string item in attachmentItems)
			{
				forward.Attachments.AddFileAttachment(item.ToString());
			}	
		}
		
		//For Shared Mailbox it is sent on behalf of Shared Mailbox Address
		if(SharedMailboxAddress!="")
		{
			forward.From = new EmailAddress(SharedMailboxAddress); 
		}
		
		forward.SendAndSaveCopy(SentItemsFolderId);
		Success =true;
	}	
}
catch(Exception ex)
{
	Success =false;
	ErrorMessage = "Error in Forward Mail: "+ex.ToString();
}
		]]></code>
  </stage>
  <stage stageid="4725984a-97ae-4b80-a19c-f686b22e6680" name="txt_Mail body" type="Data">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <narrative>Body of email</narrative>
    <displayx>-195</displayx>
    <displayy>75</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="dbb111b0-e0c6-4e02-98d6-bbd0635f50a0" name="txt_SharedMailbox" type="Data">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <narrative>Shared mailbox</narrative>
    <displayx>-225</displayx>
    <displayy>300</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="e8e8425d-7397-4ece-a977-754025d6dc95" name="txt_ErrorMessage" type="Data">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <narrative>Error message</narrative>
    <displayx>-225</displayx>
    <displayy>345</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="e1fad961-a862-49b5-97d6-a39f8bdf9380" name="txt_MailAttachments" type="Data">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <loginhibit />
    <narrative>Email attachments</narrative>
    <displayx>-195</displayx>
    <displayy>30</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="bbf92088-a407-4f18-8467-8dd03c2de505" name="txt_To" type="Data">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <narrative>Value of TO in email</narrative>
    <displayx>-195</displayx>
    <displayy>165</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d2b724dc-954f-4835-b811-a905084ea953" name="flag_MailForwarded" type="Data">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <narrative>Flag to check if email is forwarded</narrative>
    <displayx>-225</displayx>
    <displayy>255</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="515da8b2-ebd0-4048-b0aa-38ea4cb8da6c" name="txt_CC" type="Data">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <loginhibit />
    <narrative>Value of CC in email</narrative>
    <displayx>-195</displayx>
    <displayy>120</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="c11a46b7-ff2a-4962-bb8c-c2a710610a7b" name="txt_MessageId" type="Data">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <narrative>ID of email to be forwarded</narrative>
    <displayx>-195</displayx>
    <displayy>-15</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="b9a93fe5-a2cd-46c6-91a1-8d874990cb47" name="Input Data Items" type="Block">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-315</displayx>
    <displayy>-45</displayy>
    <displaywidth>240</displaywidth>
    <displayheight>240</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="dd35252f-ee98-4d01-a109-523216bc6204" name="Output Data Items" type="Block">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-315</displayx>
    <displayy>210</displayy>
    <displaywidth>180</displaywidth>
    <displayheight>210</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="eb7b87e8-4c07-4ca2-b3a6-ee7054f019d0" name="Get Email By ID2" type="Code">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="AttachmentDirectory" expr="[txt_AttachmentDirectory]" />
      <input type="text" name="MailUniqueId" expr="[txt_MailUniqueId]" />
    </inputs>
    <outputs>
      <output type="text" name="SenderName" stage="txt_SenderName" />
      <output type="text" name="SenderMailAddress" stage="txt_SenderMailAddress" />
      <output type="text" name="MailSubject" stage="txt_MailSubject" />
      <output type="text" name="MailBody" stage="txt_MailBody" />
      <output type="number" name="AttachmentCount" stage="num_AttachmentCount" />
      <output type="text" name="AttachmentNames" stage="txt_AttachmentNames" />
      <output type="text" name="To" stage="txt_To" />
      <output type="text" name="CC" stage="txt_CC" />
      <output type="datetime" name="MailSentTime" stage="dt_MailSentTime" />
      <output type="datetime" name="MailReceivedTime" stage="dt_MailReceivedTime" />
      <output type="flag" name="Success" stage="flag_GotMail" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
    </outputs>
    <onsuccess>08e7391c-d017-47b9-b692-6363f4d96ae0</onsuccess>
    <code><![CDATA[Success = false;ErrorMessage ="";SenderName="";SenderMailAddress="";MailSubject="";MailBody="";AttachmentCount=0;
AttachmentNames="";To="";CC="";MailSentTime=default(DateTime);MailReceivedTime=default(DateTime);

//Item mailItem =null;
//EmailMessage mailMessage = null;


try
{
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured.Please call 'Configure EWS' action first");
	}

		//Bind email
	EmailMessage email = EmailMessage.Bind(service, new ItemId(MailUniqueId));

	if(email!=null)
	{

		SenderName = email.Sender.Name;
		SenderMailAddress = email.Sender.Address;
		MailSubject = email.Subject;
		PropertySet properties = (BasePropertySet.FirstClassProperties);
		properties.RequestedBodyType = BodyType.Text;
		email.Load(properties);
		MailBody = email.Body;
		AttachmentCount = email.Attachments.Count;
		int index=0;
		
		//Save attachments in the Directory
		if(AttachmentDirectory!="")
		{
			if(!AttachmentDirectory.EndsWith(@"\"))
			{
				AttachmentDirectory+=@"\";
			}
			foreach (Attachment attachment in email.Attachments)
			{
				 AttachmentNames += attachment.Name +";";
				 
				 try{
				 FileAttachment attach = (FileAttachment) email.Attachments[index];
				 attach.Load(@AttachmentDirectory+attach.Name);
				 }
				 catch
				 {					 
					 //DownloadMime( attachment , AttachmentDirectory);
										 
				 }		 
				 
				 
				 index++;
			}
			if(AttachmentNames!=""&&AttachmentNames.EndsWith(";"))
			{
				AttachmentNames = AttachmentNames.Remove(AttachmentNames.Length-1);
			}
		}
		
		MailReceivedTime = DateTime.Parse(email.DateTimeReceived.ToString());
		MailSentTime = email.DateTimeSent.ToLocalTime();
		
		foreach (EmailAddress toAddress in email.ToRecipients)
		{
			 To += toAddress.Address + ";";
		}
		if(To!=""&&To.EndsWith(";"))
		{
			To = To.Remove(To.Length-1);
		}
		foreach (EmailAddress ccAddress in email.CcRecipients)
		{
			 CC += ccAddress.Address + ";";
		}
		if(CC!=""&&CC.EndsWith(";"))
		{
			CC = CC.Remove(CC.Length-1);
		}
		//email.IsRead = true;
		//email.Update(ConflictResolutionMode.AutoResolve);
		
		Success =true;
	
	}
	else
	{
		Success =false;
	ErrorMessage = "Email not found";

		}
}
catch(Exception ex)
{
	Success =false;
	ErrorMessage = "Error in Get Email: "+ex.Message;
}]]></code>
  </stage>
  <stage stageid="8ac9a517-af98-4284-9acd-7ffeb0f16a3a" name="Forward Email Special 2" type="SubSheetInfo">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <narrative>Forwards the mail to the provided recipients and removes a particular attachment</narrative>
    <displayx>-150</displayx>
    <displayy>-90</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="ed04af00-4177-4e8e-bdfe-d4bac4927508" name="Start" type="Start">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <loginhibit />
    <preconditions>
      <condition narrative="Configure EWS action should be executed prior to this" />
    </preconditions>
    <narrative>
    </narrative>
    <displayx>285</displayx>
    <displayy>-75</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="MessageId" narrative="The Unique ID of the mail message" stage="txt_MessageId" />
      <input type="text" name="MailMessage" narrative="Message to added in the mail body" stage="txt_Mail body" />
      <input type="text" name="To" narrative="The email address to send to. If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_To" />
      <input type="text" name="CC" narrative="The email address to be  kept in CC. If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_CC" />
      <input type="text" name="MailAttachments" narrative="The attachemnts to be added(full path with file name). If more than one recipient is required then each one is to be separated by a semi-colon" stage="txt_MailAttachments" />
      <input type="text" name="SharedMailboxAddress" narrative="Mail address of Shared mailbox (if any)" stage="txt_SharedMailbox" />
      <input type="text" name="txt_AttachmentToRemove" narrative="name of attachment to remove" stage="txt_AttachmentToRemove" />
    </inputs>
    <onsuccess>3fe03e43-84dd-4b4b-81ce-d3dafd23d986</onsuccess>
  </stage>
  <stage stageid="a8d20cfc-5f50-4be5-8b03-ee7f10c2b216" name="End" type="End">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>285</displayx>
    <displayy>255</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="flag" name="MailForwarded" narrative="Success or Failure of forwarding the mail" stage="flag_MailForwarded" />
      <output type="text" name="ErrorMessage" narrative="Error message if any" stage="txt_ErrorMessage" />
    </outputs>
  </stage>
  <stage stageid="cbb14f25-284a-4e80-94f7-cbe91d955443" name="Forward Mail1" type="Code">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>285</displayx>
    <displayy>150</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="ID" expr="[txt_MessageId]" />
      <input type="text" name="MailMessage" expr="[txt_Mail body]" />
      <input type="text" name="MailAttachments" expr="[txt_MailAttachments]" />
      <input type="text" name="SharedMailboxAddress" expr="[txt_SharedMailbox]" />
      <input type="text" name="To" expr="[txt_To]" />
      <input type="text" name="CC" expr="[txt_CC]" />
      <input type="text" name="AttachmentToRemove" expr="[txt_AttachmentToRemove]" />
    </inputs>
    <outputs>
      <output type="flag" name="Success" stage="flag_MailForwarded" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
    </outputs>
    <onsuccess>8cf62d27-9860-4c06-a0d2-890e15661381</onsuccess>
    <code><![CDATA[Success = false;
ErrorMessage = "";
FolderId SentItemsFolderId = null;
FolderId DraftsFolderId = null;
try
{
	
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured.Please call 'Configure EWS' action first");
	}
	//Bind email
	EmailMessage email = EmailMessage.Bind(service, new ItemId(ID));
	if (email != null)
	{
		//Create response message and set properties
		ResponseMessage response = email.CreateForward();
		response.BodyPrefix = MailMessage;
		//if(!MailMessage.StartsWith("<html",StringComparison.OrdinalIgnoreCase))
	 
		//response.Body.BodyType = BodyType.Text;
		
		//Add To recipients
		if (To !="")
		{
			string [] mailId = To.Split(';');
			foreach (string item in mailId)
			{
				response.ToRecipients.Add(item.ToString());
			}
		}
		//Add CC recipients
		if (CC !="")
		{
			string [] mailId = CC.Split(';');
			foreach (string item in mailId)
			{
				response.CcRecipients.Add(item.ToString());
			}
		}
		
		
		//Get FolderId's of Sent and Drafts folder for respective mailbox
		if(SharedMailboxAddress!="")
		{
			SentItemsFolderId = new FolderId(WellKnownFolderName.SentItems,new Mailbox(SharedMailboxAddress));
			DraftsFolderId = new FolderId(WellKnownFolderName.Drafts,new Mailbox(SharedMailboxAddress));
			//forward.From = new EmailAddress(SharedMailboxAddress);
		}
		else
		{	
			SentItemsFolderId = new FolderId(WellKnownFolderName.SentItems);
			DraftsFolderId = new FolderId(WellKnownFolderName.Drafts);
		}
		//Save mail in drafts as mail message(As attachments can't be added in Response message)
		EmailMessage forward = response.Save(DraftsFolderId);
		
		PropertySet properties = (BasePropertySet.FirstClassProperties);
		//properties.RequestedBodyType = BodyType.Text;
		forward.Load(properties);
		
			 
		
			foreach (Attachment attachment in forward.Attachments)
			{
				 if ( attachment.Name.Trim() == AttachmentToRemove.Trim())
				 {
					 forward.Attachments.Remove(attachment);
					 break;					 
				 }				 
			}
		
		if(MailAttachments !="")
		{
			string [] attachmentItems = MailAttachments.Split(';');
			
			foreach (string item in attachmentItems)
			{
				forward.Attachments.AddFileAttachment(item.ToString());
			}					
		}
		
		//For Shared Mailbox it is sent on behalf of Shared Mailbox Address
		if(SharedMailboxAddress!="")
		{
			forward.From = new EmailAddress(SharedMailboxAddress); 
		}
		
		forward.SendAndSaveCopy(SentItemsFolderId);
		Success =true;
	}	
}
catch(Exception ex)
{
	Success =false;
	ErrorMessage = "Error in Forward Mail: "+ex.ToString();
}
		]]></code>
  </stage>
  <stage stageid="adc2a543-8a3b-4538-9e2d-c6a5b00dc897" name="txt_Mail body" type="Data">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <narrative>Body of email</narrative>
    <displayx>-105</displayx>
    <displayy>90</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="fd9b7d9a-ddbb-4080-b5b6-05bb25901cb8" name="txt_SharedMailbox" type="Data">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <narrative>Shared mailbox</narrative>
    <displayx>-135</displayx>
    <displayy>375</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="b7d3de84-18ab-4e16-bca5-adecb883916a" name="txt_ErrorMessage" type="Data">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <narrative>Error message</narrative>
    <displayx>-135</displayx>
    <displayy>420</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="3e40520d-544f-4b06-bdf8-62ebb0c32ce4" name="txt_MailAttachments" type="Data">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <loginhibit />
    <narrative>Email attachments</narrative>
    <displayx>-105</displayx>
    <displayy>45</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="837be6a1-c401-4635-b473-f744bef10435" name="txt_To" type="Data">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <narrative>Value of TO in email</narrative>
    <displayx>-105</displayx>
    <displayy>180</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="601be1ee-1d05-4869-be39-3559969ec251" name="flag_MailForwarded" type="Data">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <narrative>Flag to check if email is forwarded</narrative>
    <displayx>-135</displayx>
    <displayy>330</displayy>
    <displaywidth>120</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="3fe03e43-84dd-4b4b-81ce-d3dafd23d986" name="Is Mail Id Empty?" type="Decision">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>285</displayx>
    <displayy>-15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[txt_MessageId]=&quot;&quot;" />
    <ontrue>02873c57-a2a3-456f-b6d5-3b1d344161a3</ontrue>
    <onfalse>231a3761-a51e-476a-b25f-a9ba12331a26</onfalse>
  </stage>
  <stage stageid="02873c57-a2a3-456f-b6d5-3b1d344161a3" name="Mail Id is empty" type="Exception">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <narrative>
    </narrative>
    <displayx>405</displayx>
    <displayy>-15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;Error in Forward Mail: Mail Id cannot be empty&quot;" />
  </stage>
  <stage stageid="d79fc661-095d-453e-a5b2-33459c7e1616" name="txt_CC" type="Data">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <loginhibit />
    <narrative>Value of CC in email</narrative>
    <displayx>-105</displayx>
    <displayy>135</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="42635a85-5d76-4a97-9efe-e0fe759abfc4" name="txt_MessageId" type="Data">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <narrative>ID of email to be forwarded</narrative>
    <displayx>-105</displayx>
    <displayy>0</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="7670b151-8b71-4232-8518-28b07176a839" name="Input Data Items" type="Block">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-225</displayx>
    <displayy>-30</displayy>
    <displaywidth>240</displaywidth>
    <displayheight>300</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="9a304d9b-6489-4484-af02-c9d8b99b7298" name="Output Data Items" type="Block">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-225</displayx>
    <displayy>285</displayy>
    <displaywidth>180</displaywidth>
    <displayheight>210</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="36c2641e-223e-4d74-9cac-27454614dadc" name="txt_AttachmentToRemove" type="Data">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <narrative>
    </narrative>
    <displayx>-105</displayx>
    <displayy>225</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="bcbe1108-b19c-47f8-b350-1a925fb695d1" name="List emails within Datetime - Fast" type="SubSheetInfo">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <narrative>Returns all emails for within the Time Period</narrative>
    <displayx>-330</displayx>
    <displayy>-120</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="08be0e9a-07db-4ce6-9df3-24a5384450aa" name="Start" type="Start">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-165</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Shared Mailbox" narrative="Mail address of Shared mailbox (if any)" stage="txt_SharedMailbox" />
      <input type="text" name="Mail Subject" narrative="Subject of the Email" stage="txt_MailSubject" />
      <input type="text" name="Sub Folder" narrative="Mail Folder to look for mails" stage="txt_SubFolder" />
      <input type="flag" name="Unread Only?" narrative="Get only Unread emails" stage="flag_UnreadOnly" />
      <input type="datetime" name="Mail Start Time" narrative="Mail Start Time" stage="dt_MailStartTime" />
      <input type="datetime" name="Mail End Time" narrative="Mail End Time" stage="dt_MailEndTime" />
      <input type="number" name="Num Max Rows" narrative="max rows" stage="num_MaxRows" />
    </inputs>
    <onsuccess>c2d9e70d-dde8-4e1a-86ab-849203a6f270</onsuccess>
  </stage>
  <stage stageid="824f12c2-46c5-4e90-b14e-d4007e1c4823" name="End" type="End">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>225</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="collection" name="Email" narrative="Email Collection" stage="coll_Email" />
      <output type="flag" name="Mail Found" narrative="Mail Found" stage="flag_Success" />
      <output type="text" name="Error Message" narrative="Error message if any" stage="txt_ErrorMessage" />
    </outputs>
  </stage>
  <stage stageid="197c4f4a-2a90-4da5-b474-d5816bb1e1bf" name="coll_Email" type="Collection">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <narrative>Collection of emails</narrative>
    <displayx>-330</displayx>
    <displayy>300</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>collection</datatype>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="68beff7f-6757-4a4b-a677-044463d000bc" name="Get list of mails Fast1" type="Code">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>75</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="MailSubject" expr="[txt_MailSubject]" />
      <input type="flag" name="UnreadOnly" expr="[flag_UnreadOnly]" />
      <input type="text" name="MailFolder" expr="[txt_SubFolder]" />
      <input type="text" name="SharedMailboxAddress" expr="[txt_SharedMailbox]" />
      <input type="datetime" name="MailStartTime" expr="[dt_MailStartTime]" />
      <input type="datetime" name="MailEndTime" expr="[dt_MailEndTime]" />
      <input type="number" name="MaxRows" expr="[num_MaxRows]" />
    </inputs>
    <outputs>
      <output type="collection" name="Emails" stage="coll_Email" />
      <output type="flag" name="Success" stage="flag_Success" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
    </outputs>
    <onsuccess>e3ee748f-06f3-4280-992c-2c4486e423ee</onsuccess>
    <code><![CDATA[Success = false;
Emails = null;
ErrorMessage=null;
if(MailFolder=="")
{
	MailFolder="Inbox";
}
string MailST = MailStartTime.ToString();
string MailET = MailEndTime.ToString();

try
{
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured.Please call 'Configure EWS' action first");
	}
	
	FolderId mailFolderId = null;
	SearchFilter.SearchFilterCollection filters = new SearchFilter.SearchFilterCollection(LogicalOperator.And);
	if(UnreadOnly)
	{
		filters.Add(new SearchFilter.IsEqualTo(EmailMessageSchema.IsRead, false));
	}
	if(MailSubject!="")
	{
		filters.Add(new SearchFilter.ContainsSubstring(EmailMessageSchema.Subject, MailSubject));
	}
	filters.Add(new SearchFilter.IsGreaterThan(EmailMessageSchema.DateTimeReceived, DateTime.Parse(MailST)));
	filters.Add(new SearchFilter.IsLessThan(EmailMessageSchema.DateTimeReceived, DateTime.Parse(MailET)));
	if(SharedMailboxAddress!="")
	{
		mailFolderId = getFolderId(SharedMailboxAddress,MailFolder);
	}
	else
	{	
		mailFolderId = getFolderId(MailFolder);
	}
	List<EmailMessage> emails = getListOfMails(filters,mailFolderId);
	System.Data.DataTable emailTable = createEmailTableFast();
	int counter = 1;
	foreach (EmailMessage email in emails)
	{
		if ( counter >  MaxRows)
		 break;
		addEmailToCollectionFast(emailTable, email);
		counter = counter + 1;		
		
	}
	Emails = emailTable;
	emailTable = null;
	
	int i=0;
	i=emails.Count;
	if (i>0)
	{
		Success =true;
		ErrorMessage = "";
	}
	else
	{
		Success =false;
		ErrorMessage = "";
	}
	
	//Success =true;
}
catch(Exception ex)
{
	Success =false;
	ErrorMessage = "Error:" + ex.ToString();
}
]]></code>
  </stage>
  <stage stageid="23610835-fd2e-4b3b-9ce3-4578cf2c25d3" name="txt_MailSubject" type="Data">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <narrative>Subject of email</narrative>
    <displayx>-240</displayx>
    <displayy>45</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="447dc831-edba-4cf2-a951-1513b6433132" name="txt_SubFolder" type="Data">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <narrative>Mailbox subfolder</narrative>
    <displayx>-240</displayx>
    <displayy>0</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="e9346a54-d137-4d7e-afb9-7922a3555b69" name="flag_UnreadOnly" type="Data">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <narrative>Unread emails</narrative>
    <displayx>-330</displayx>
    <displayy>0</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="753ae502-f180-40a3-834c-587d3924391d" name="txt_SharedMailbox" type="Data">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <loginhibit />
    <narrative>Shared mailbox folder</narrative>
    <displayx>-330</displayx>
    <displayy>45</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="4e5b55d6-e3df-4c5b-8fe1-a18b730d2b3d" name="flag_Success" type="Data">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <narrative>Flag to check status of the processing</narrative>
    <displayx>-330</displayx>
    <displayy>390</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="7852f391-7c99-4e58-b866-eeb99a35eeb6" name="dt_MailStartTime" type="Data">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <narrative>Start time of the email</narrative>
    <displayx>-330</displayx>
    <displayy>90</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>datetime</datatype>
    <initialvalue>2018-09-05 01:04:25Z</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="b7c2b00f-80ee-4618-b4d3-58ab00cea4d6" name="dt_MailEndTime" type="Data">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <narrative>End time of the email</narrative>
    <displayx>-240</displayx>
    <displayy>90</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>datetime</datatype>
    <initialvalue>2021-09-05 18:04:25Z</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="155f6a1a-9777-49d2-b0e4-354020a09841" name="txt_ErrorMessage" type="Data">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <narrative>Error message while processing emails</narrative>
    <displayx>-330</displayx>
    <displayy>345</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="c2d9e70d-dde8-4e1a-86ab-849203a6f270" name="Is ST/ET Empty?" type="Decision">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="([dt_MailStartTime]=&quot;&quot;)OR([dt_MailEndTime]=&quot;&quot;)" />
    <ontrue>a335b99b-c4cd-41f6-a060-fcf1589f493d</ontrue>
    <onfalse>eaac20a7-9b73-46e1-a8f6-9000fe0ecf20</onfalse>
  </stage>
  <stage stageid="a335b99b-c4cd-41f6-a060-fcf1589f493d" name="Mail Start/End Time is null" type="Exception">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <narrative>
    </narrative>
    <displayx>210</displayx>
    <displayy>-105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;Mail Start/End Time cannot be empty&quot;" />
  </stage>
  <stage stageid="0741a97a-139d-4f87-b782-3a7c11cbd69c" name="Output Data Items" type="Block">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-405</displayx>
    <displayy>270</displayy>
    <displaywidth>225</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="2ca361fb-2813-420f-ac24-dac2969fb82e" name="Input Data Items" type="Block">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-405</displayx>
    <displayy>-30</displayy>
    <displaywidth>225</displaywidth>
    <displayheight>270</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="128cb53b-5caf-488a-bef4-c6ab264f5f5b" name="num_MaxRows" type="Data">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <narrative>
    </narrative>
    <displayx>-345</displayx>
    <displayy>135</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue>100000</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="420ff0f8-7e8b-4958-a380-208b46797727" name="Start" type="Start">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>0</displayx>
    <displayy>-180</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Shared Mailbox" narrative="Optional. Mail address of Shared mailbox (if any)" stage="txt_SharedMailbox" />
      <input type="flag" name="UnreadOnly" narrative="Include only Unread mails" stage="flag_UnreadOnly" />
      <input type="text" name="Subject" narrative="Optional. To filter mails based on Subject" stage="txt_Subject" />
      <input type="text" name="Mail Folder" narrative="Optional. The name of a -folder  from which to get emails.  If not set the Inbox will be used." stage="txt_MailFolder" />
      <input type="text" name="Attachment Directory" narrative="Optional. Folder on computer or network where any attachments should be saved to.  If not set than attachments will be ignored" stage="txt_AttachmentDirectory" />
      <input type="text" name="MoveToFolder" narrative="Optional. The name of a folder where to move the email" stage="txt_MoveToFolder" />
    </inputs>
    <onsuccess>c12d994c-7f88-496e-baa5-618cb4ffd7fd</onsuccess>
  </stage>
  <stage stageid="b8f1d8ee-0d44-412c-b3e5-712015f88142" name="End" type="End">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>0</displayx>
    <displayy>150</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="text" name="SenderName" narrative="Name of the mail Sender" stage="txt_SenderName" />
      <output type="text" name="SenderMailAddress" narrative="Mail address of the Sender" stage="txt_SenderMailAddress" />
      <output type="text" name="Subject" narrative="The Subject of the Mail" stage="txt_MailSubject" />
      <output type="text" name="MailBody" narrative="The Body of the message" stage="txt_MailBody" />
      <output type="text" name="To" narrative="Mail Recipients in the To seperated by Semicolon" stage="txt_To" />
      <output type="text" name="CC" narrative="Mail Recipients in the CC seperated by Semicolon" stage="txt_CC" />
      <output type="datetime" name="MailSentTime" narrative="Mail Sent Time" stage="dt_MailSentTime" />
      <output type="datetime" name="MailReceivedTime" narrative="Mail Received Time" stage="dt_MailReceivedTime" />
      <output type="number" name="AttachmentCount" narrative="Attachment Count" stage="num_AttachmentCount" />
      <output type="text" name="AttachmentNames" narrative="Names of the Attachment separated by semicolon " stage="txt_AttachmentNames" />
      <output type="text" name="MailUniqueId" narrative="The Unique ID of the Mail" stage="txt_MailUniqueId" />
      <output type="flag" name="GotMail" narrative="Flag. Got any mail" stage="flag_GotMail" />
      <output type="text" name="ErrorMessage" narrative="Error message if any" stage="txt_ErrorMessage" />
    </outputs>
  </stage>
  <stage stageid="6e6ca7fa-f9c8-44a4-9103-c4dd4ee01750" name="Get Email1" type="Code">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>0</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Subject" expr="[txt_Subject]" />
      <input type="flag" name="UnreadOnly" expr="[flag_UnreadOnly]" />
      <input type="text" name="MailFolder" expr="[txt_MailFolder]" />
      <input type="text" name="MoveToSubFolder" expr="[txt_MoveToFolder]" />
      <input type="text" name="AttachmentDirectory" expr="[txt_AttachmentDirectory]" />
      <input type="text" name="SharedMailboxAddress" expr="[txt_SharedMailbox]" />
    </inputs>
    <outputs>
      <output type="text" name="SenderName" stage="txt_SenderName" />
      <output type="text" name="SenderMailAddress" stage="txt_SenderMailAddress" />
      <output type="text" name="MailSubject" stage="txt_MailSubject" />
      <output type="text" name="MailBody" stage="txt_MailBody" />
      <output type="number" name="AttachmentCount" stage="num_AttachmentCount" />
      <output type="text" name="AttachmentNames" stage="txt_AttachmentNames" />
      <output type="text" name="To" stage="txt_To" />
      <output type="text" name="CC" stage="txt_CC" />
      <output type="text" name="MailUniqueId" stage="txt_MailUniqueId" />
      <output type="datetime" name="MailSentTime" stage="dt_MailSentTime" />
      <output type="datetime" name="MailReceivedTime" stage="dt_MailReceivedTime" />
      <output type="flag" name="Success" stage="flag_GotMail" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
    </outputs>
    <onsuccess>4f1e5c1c-88cb-4b72-870f-fc8b04be3e1b</onsuccess>
    <code><![CDATA[Success = false;ErrorMessage ="";SenderName="";SenderMailAddress="";MailSubject="";MailBody="";AttachmentCount=0;
AttachmentNames="";To="";CC="";MailUniqueId="";MailSentTime=default(DateTime);MailReceivedTime=default(DateTime);

Item mailItem =null;
EmailMessage mailMessage = null;
FolderId mailFolderId = null;
FolderId moveFolderId = null;

//Set Mail folder as Inbox if no Folder is provided
if(MailFolder=="")
{
	MailFolder="Inbox";
}

try
{
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured.Please call 'Configure EWS' action first");
	}

	SearchFilter.SearchFilterCollection filters = new SearchFilter.SearchFilterCollection(LogicalOperator.And);
	//Set Filters
	if(UnreadOnly)
	{
		filters.Add(new SearchFilter.IsEqualTo(EmailMessageSchema.IsRead, false));
	}
	
	if(Subject!="")
	{
		filters.Add(new SearchFilter.ContainsSubstring(EmailMessageSchema.Subject, Subject,ContainmentMode.Substring,ComparisonMode.IgnoreCase));
	}
	
	if(filters.Count<1)
	{
		filters=null;
	}
	
	//Get Folder ID for the Folder provided
	if(SharedMailboxAddress!="")
	{		
		mailFolderId = getFolderId(SharedMailboxAddress,MailFolder);
	}
	else
	{	
		mailFolderId = getFolderId(MailFolder);
	}
	
	//Mail folder is not available
	if(mailFolderId==null)
	{
		throw new Exception("Unable to find the folder '"+MailFolder+"' to read mail");
	}
	
	//Get mail
	List<EmailMessage> emails = getMail(filters,mailFolderId);
	//no mail found
	if(emails.Count<1)
	{
		throw new Exception("No mails found in '"+MailFolder+"' for the mentioned criteria");
	}
	
	//Get mail attributes
	foreach(EmailMessage email in emails)
	{
		SenderName = email.Sender.Name;
		SenderMailAddress = email.Sender.Address;
		MailSubject = email.Subject;
		PropertySet properties = (BasePropertySet.FirstClassProperties);
		properties.RequestedBodyType = BodyType.Text;
		email.Load(properties);
		MailBody = email.Body;
		AttachmentCount = email.Attachments.Count;
		int index=0;
		
		//Save attachments in the Directory
		if(AttachmentDirectory!="")
		{
			if(!AttachmentDirectory.EndsWith(@"\"))
			{
				AttachmentDirectory+=@"\";
			}
			foreach (Attachment attachment in email.Attachments)
			{
				 AttachmentNames += attachment.Name +";";
				 FileAttachment attach = (FileAttachment) email.Attachments[index];
				 attach.Load(@AttachmentDirectory+attach.Name);
				 index++;
			}
			if(AttachmentNames!=""&&AttachmentNames.EndsWith(";"))
			{
				AttachmentNames = AttachmentNames.Remove(AttachmentNames.Length-1);
			}
		}
		
		MailReceivedTime = DateTime.Parse(email.DateTimeReceived.ToString());
		MailSentTime = email.DateTimeSent.ToLocalTime();
		ErrorMessage = email.DateTimeReceived.ToString();
		
		foreach (EmailAddress toAddress in email.ToRecipients)
		{
			 To += toAddress.Address + ";";
		}
		if(To!=""&&To.EndsWith(";"))
		{
			To = To.Remove(To.Length-1);
		}
		foreach (EmailAddress ccAddress in email.CcRecipients)
		{
			 CC += ccAddress.Address + ";";
		}
		if(CC!=""&&CC.EndsWith(";"))
		{
			CC = CC.Remove(CC.Length-1);
		}
		MailUniqueId = email.Id.UniqueId;
		email.IsRead = true;
		email.Update(ConflictResolutionMode.AutoResolve);
		
		//Move mail to the mentioned folder
		if(MoveToSubFolder!="")
		{
				//FolderId folderId = getFolderId(service,SharedMailboxAddress,MoveToSubFolder);
				if(SharedMailboxAddress!="")
				{
					moveFolderId = getFolderId(SharedMailboxAddress,MoveToSubFolder);
				}
				else
				{	
					moveFolderId = getFolderId(MoveToSubFolder);
				}
				if(moveFolderId!=null)
				{
					mailItem=email.Move(moveFolderId);
					mailMessage = EmailMessage.Bind(service,mailItem.Id);
					MailUniqueId = mailMessage.Id.UniqueId;
				}
				else
				{
					throw new Exception("Error in Get mail: Mail found, but unable to move email. '"+MoveToSubFolder+"' is not found!");
				}
		}
		
		ErrorMessage ="";
		Success =true;
		break;
	}
}
catch(Exception ex)
{
	Success =false;
	ErrorMessage = "Error in Get Email: "+ex.Message;
}]]></code>
  </stage>
  <stage stageid="2d0ecea2-28ed-4ada-8d70-3bf0ea98f0fe" name="flag_GotMail" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Flaf to check if email is received</narrative>
    <displayx>-300</displayx>
    <displayy>300</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="2bcfdf2b-67db-44e5-b371-1511d81d1cf9" name="txt_Subject" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Email subject</narrative>
    <displayx>-315</displayx>
    <displayy>30</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="a414660c-f705-4161-9155-620fb960ff12" name="txt_MailFolder" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Email folder for processing</narrative>
    <displayx>-315</displayx>
    <displayy>-15</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="8c264f53-a73d-472a-8f94-5b3ad0f1ff22" name="txt_MoveToFolder" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Folder used to move emails</narrative>
    <displayx>-420</displayx>
    <displayy>30</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="af143a7a-4a89-4fee-95de-cc1bb1f3d91e" name="txt_AttachmentDirectory" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Folder to save email attachments</narrative>
    <displayx>-420</displayx>
    <displayy>75</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="c566f72b-fbff-4e24-89dc-f11774c9ce0e" name="flag_UnreadOnly" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Unread emails</narrative>
    <displayx>-420</displayx>
    <displayy>-15</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue>True</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="39d5d985-41a1-4458-ac00-9ee33e87e57e" name="txt_SharedMailbox" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <loginhibit />
    <narrative>Shared mailbox for email</narrative>
    <displayx>-420</displayx>
    <displayy>120</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="a43aac3b-c7fe-4f01-9a28-c16b9b525526" name="txt_ErrorMessage" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Error messages</narrative>
    <displayx>-180</displayx>
    <displayy>345</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="7daea59a-89a5-482d-9a02-d6e817260f30" name="txt_SenderName" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Name of sender of emails</narrative>
    <displayx>-420</displayx>
    <displayy>300</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="8c249553-aeb4-4e11-970a-af729576c09f" name="txt_SenderMailAddress" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Email address of sender</narrative>
    <displayx>-315</displayx>
    <displayy>210</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="fcab9a6c-ae6a-43c9-918e-1043505ba6a2" name="txt_MailBody" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Body of ermails</narrative>
    <displayx>-420</displayx>
    <displayy>345</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="648a6512-b4f1-4f73-bab9-278ecc0e5c25" name="txt_AttachmentNames" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Name of attachements</narrative>
    <displayx>-180</displayx>
    <displayy>255</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d15aa4f0-3fa9-4252-81d6-5c4602a128fc" name="txt_To" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Value of TO in emails</narrative>
    <displayx>-300</displayx>
    <displayy>255</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="4a204c24-2c89-4b0f-bca5-7672d3cc172a" name="txt_CC" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>CC value of emails</narrative>
    <displayx>-300</displayx>
    <displayy>345</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="b25828e6-abbe-49ce-9429-b066e5808ade" name="txt_MailUniqueId" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>ID generated for ermails</narrative>
    <displayx>-435</displayx>
    <displayy>210</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="eae75995-12cf-4624-991f-9fe219f981d1" name="dt_MailSentTime" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Send time of emails</narrative>
    <displayx>-180</displayx>
    <displayy>210</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>datetime</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="a013f3ff-8fe7-42ce-8243-eec3112f8096" name="dt_MailReceivedTime" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Received time of ermails</narrative>
    <displayx>-180</displayx>
    <displayy>300</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>datetime</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="50b58c15-bfa6-468a-8266-87efbe27b48b" name="txt_MailSubject" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Subject of email</narrative>
    <displayx>-420</displayx>
    <displayy>390</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="9196f50f-1dd6-4123-a44a-ebf7add51bba" name="num_AttachmentCount" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>Count of number of email attachments</narrative>
    <displayx>-420</displayx>
    <displayy>255</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="f6fefb53-e450-4e5e-ac6b-9c14df8673ff" name="Input Data Items" type="Block">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-495</displayx>
    <displayy>-45</displayy>
    <displaywidth>240</displaywidth>
    <displayheight>195</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="711b0d7e-db18-47dd-b41b-91c4b23b6240" name="Output Data Items" type="Block">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-495</displayx>
    <displayy>165</displayy>
    <displaywidth>390</displaywidth>
    <displayheight>255</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="e301a421-405a-421c-8bc8-9ba537c798d8" name="Counter&lt;2" type="Decision">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>0</displayx>
    <displayy>-75</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[num_Counter]&lt;2" />
    <ontrue>6e6ca7fa-f9c8-44a4-9103-c4dd4ee01750</ontrue>
    <onfalse>fae1d7da-d40c-460d-bc87-92befa8b112b</onfalse>
  </stage>
  <stage stageid="96efb7f9-a297-41d3-ab90-a64f92d47715" name="Increase Counter" type="Calculation">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-105</displayx>
    <displayy>-75</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>e301a421-405a-421c-8bc8-9ba537c798d8</onsuccess>
    <calculation expression="[num_Counter]+1" stage="num_Counter" />
  </stage>
  <stage stageid="4f1e5c1c-88cb-4b72-870f-fc8b04be3e1b" name="Retry" type="Decision">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>0</displayx>
    <displayy>90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[flag_GotMail]" />
    <ontrue>b8f1d8ee-0d44-412c-b3e5-712015f88142</ontrue>
    <onfalse>8f52c118-64e5-43cc-8bbf-267d9660b849</onfalse>
  </stage>
  <stage stageid="fae1d7da-d40c-460d-bc87-92befa8b112b" name="SE:Error in get Email" type="Exception">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>
    </narrative>
    <displayx>105</displayx>
    <displayy>-75</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="System Exception" detail="&quot;Error in get Email :&quot; &amp; &quot;&quot; &amp;[txt_ErrorMessage]" />
  </stage>
  <stage stageid="00eebc0c-7e55-4e31-9e2e-321e5f982d8c" name="num_Counter" type="Data">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>
    </narrative>
    <displayx>-600</displayx>
    <displayy>90</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="c12d994c-7f88-496e-baa5-618cb4ffd7fd" name="Initialise Counter" type="Calculation">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>0</displayx>
    <displayy>-135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>e301a421-405a-421c-8bc8-9ba537c798d8</onsuccess>
    <calculation expression="0" stage="num_Counter" />
  </stage>
  <stage stageid="452381c3-fea8-4510-b74a-4c54f93422a9" name="Local data Items" type="Block">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <narrative>
    </narrative>
    <displayx>-660</displayx>
    <displayy>15</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>165</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="0000FF" />
  </stage>
  <stage stageid="55675306-dcee-40f2-99fe-0192b8bd74d3" name="Initialise Counter" type="Calculation">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>-60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>e4d900f2-56c9-43fe-ba29-35b3bddf41f8</onsuccess>
    <calculation expression="0" stage="num_Counter" />
  </stage>
  <stage stageid="e4d900f2-56c9-43fe-ba29-35b3bddf41f8" name="Counter&lt;2" type="Decision">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[num_Counter]&lt;2" />
    <ontrue>c9d871b8-66b5-4ce1-abde-dc775aa8536c</ontrue>
    <onfalse>2d7412b6-7af8-41b8-93b9-c2ed405b4e91</onfalse>
  </stage>
  <stage stageid="7ae5e395-505f-4017-80f6-c2fcb45be421" name="Increase Counter" type="Calculation">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-75</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>e4d900f2-56c9-43fe-ba29-35b3bddf41f8</onsuccess>
    <calculation expression="[num_Counter]+1" stage="num_Counter" />
  </stage>
  <stage stageid="2d7412b6-7af8-41b8-93b9-c2ed405b4e91" name="SE:Error in get Email" type="Exception">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="System Exception" detail="&quot;Error in get Email :&quot; &amp; &quot;&quot; &amp;[txt_ErrorMessage]" />
  </stage>
  <stage stageid="08e7391c-d017-47b9-b692-6363f4d96ae0" name="Retry" type="Decision">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>150</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[flag_GotMail]" />
    <ontrue>ee6358ef-85e7-4eb1-a6e0-0630492218d3</ontrue>
    <onfalse>be85e48f-ddf0-41e1-9e3e-7ed3e6b39a4d</onfalse>
  </stage>
  <stage stageid="40cc1bba-fa95-4cfc-8d59-3646f6e1347d" name="num_Counter" type="Data">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <narrative>
    </narrative>
    <displayx>-510</displayx>
    <displayy>585</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="f75235da-c9c3-407f-91e3-0845a1fc8c5d" name="Initialise Counter" type="Calculation">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>fac3e73e-24ef-412f-9c6f-5a6a990bf555</onsuccess>
    <calculation expression="0" stage="num_Counter" />
  </stage>
  <stage stageid="fac3e73e-24ef-412f-9c6f-5a6a990bf555" name="Counter&lt;2" type="Decision">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[num_Counter]&lt;2" />
    <ontrue>4769ee32-633b-4e6a-8813-bf5b7aa22aff</ontrue>
    <onfalse>8da56dd1-6e91-4792-a137-af0c913c3661</onfalse>
  </stage>
  <stage stageid="8da56dd1-6e91-4792-a137-af0c913c3661" name="SE:Error in configure EWS" type="Exception">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <narrative>
    </narrative>
    <displayx>255</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="System Exception" detail="&quot;Error in configure EWS:&quot; &amp; &quot;&quot; &amp;[txt_ErrorMessage]" />
  </stage>
  <stage stageid="d4ed9d83-2a33-4fff-add6-f738f47e9fea" name="Retry" type="Decision">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>135</displayx>
    <displayy>180</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[flag_Configured]" />
    <ontrue>71cf4fc8-ab85-4cbb-8de6-ac40c605e0fb</ontrue>
    <onfalse>ffc6ee37-d631-475e-8bec-5f12b74472b4</onfalse>
  </stage>
  <stage stageid="bab94b30-d02d-4985-ad43-d00e84294179" name="Increase Counter" type="Calculation">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>45</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>fac3e73e-24ef-412f-9c6f-5a6a990bf555</onsuccess>
    <calculation expression="[num_Counter]+1" stage="num_Counter" />
  </stage>
  <stage stageid="dd208ed1-3ed8-4bbc-a3b6-0d9645d47689" name="num_Counter" type="Data">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <narrative>
    </narrative>
    <displayx>-600</displayx>
    <displayy>60</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="872b480c-8520-4266-8bf6-d98521fc12f5" name="Local data Items" type="Block">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <narrative>
    </narrative>
    <displayx>-660</displayx>
    <displayy>-15</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>165</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="0000FF" />
  </stage>
  <stage stageid="ea3360d8-6e79-45f3-b79a-508e89d0c0a0" name="Time Out1" type="WaitEnd">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-105</displayx>
    <displayy>0</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>96efb7f9-a297-41d3-ab90-a64f92d47715</onsuccess>
    <groupid>681c1dc8-43d7-4c92-86f1-5c01a331809f</groupid>
  </stage>
  <stage stageid="8f52c118-64e5-43cc-8bbf-267d9660b849" name="Wait1" type="WaitStart">
    <subsheetid>4a0e5d5a-994e-4f7b-bf43-823f13c928d3</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-105</displayx>
    <displayy>90</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <groupid>681c1dc8-43d7-4c92-86f1-5c01a331809f</groupid>
    <choices />
    <timeout>2</timeout>
  </stage>
  <stage stageid="32479b91-be76-4cad-96dd-213a51cb9f85" name="Time Out1" type="WaitEnd">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-75</displayx>
    <displayy>105</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>7ae5e395-505f-4017-80f6-c2fcb45be421</onsuccess>
    <groupid>b487cf7c-a633-49ed-992f-dd7757f4aaf0</groupid>
  </stage>
  <stage stageid="be85e48f-ddf0-41e1-9e3e-7ed3e6b39a4d" name="Wait1" type="WaitStart">
    <subsheetid>51430e91-6279-4abe-8d01-97f40f8bc2cc</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-75</displayx>
    <displayy>150</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <groupid>b487cf7c-a633-49ed-992f-dd7757f4aaf0</groupid>
    <choices />
    <timeout>2</timeout>
  </stage>
  <stage stageid="6adc84c7-6354-44a9-8fd0-152d0b54f55d" name="Time Out1" type="WaitEnd">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>45</displayx>
    <displayy>135</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>bab94b30-d02d-4985-ad43-d00e84294179</onsuccess>
    <groupid>3f1f42a6-f8ae-474d-9f56-b4ae2ee44a04</groupid>
  </stage>
  <stage stageid="ffc6ee37-d631-475e-8bec-5f12b74472b4" name="Wait1" type="WaitStart">
    <subsheetid>695b9d07-0599-4460-92b1-46fb3aa0265c</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>45</displayx>
    <displayy>180</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <groupid>3f1f42a6-f8ae-474d-9f56-b4ae2ee44a04</groupid>
    <choices />
    <timeout>2</timeout>
  </stage>
  <stage stageid="08a8cc69-7940-4429-b697-307a139ef3e5" name="Initialise Counter" type="Calculation">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>-165</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>733a79ac-6048-4306-99eb-be372ce8a657</onsuccess>
    <calculation expression="0" stage="num_Counter" />
  </stage>
  <stage stageid="733a79ac-6048-4306-99eb-be372ce8a657" name="Counter&lt;2" type="Decision">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>-120</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[num_Counter]&lt;2" />
    <ontrue>63a7ff4b-85b3-4f12-8576-44b92b0bbe22</ontrue>
    <onfalse>f54e597b-5fb5-402d-a114-9002be54240f</onfalse>
  </stage>
  <stage stageid="f54e597b-5fb5-402d-a114-9002be54240f" name="SE:Error in Send EMail" type="Exception">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>-120</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="System Exception" detail="&quot;Error in Send EMail:&quot; &amp; &quot;&quot; &amp;[txt_ErrorMessage]" />
  </stage>
  <stage stageid="28a385ce-84ca-4300-8335-4680383bde15" name="Increase Counter" type="Calculation">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-120</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>733a79ac-6048-4306-99eb-be372ce8a657</onsuccess>
    <calculation expression="[num_Counter]+1" stage="num_Counter" />
  </stage>
  <stage stageid="f94c9b26-8872-4e46-a3c2-e71eeedff62c" name="Retry" type="Decision">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>-15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[flag_MailSent]" />
    <ontrue>9e497ae8-e452-4750-a0bc-21ac6b44f5cf</ontrue>
    <onfalse>dfe9b7e3-ceb6-4918-ac57-0c70d748baf9</onfalse>
  </stage>
  <stage stageid="773f0b84-c322-49cf-87cd-cebc8d4431e8" name="Time Out1" type="WaitEnd">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-60</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>28a385ce-84ca-4300-8335-4680383bde15</onsuccess>
    <groupid>c7b4d48e-c3f0-45c3-bc89-f148ad3d2e40</groupid>
  </stage>
  <stage stageid="dfe9b7e3-ceb6-4918-ac57-0c70d748baf9" name="Wait1" type="WaitStart">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-60</displayx>
    <displayy>-15</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <groupid>c7b4d48e-c3f0-45c3-bc89-f148ad3d2e40</groupid>
    <choices />
    <timeout>2</timeout>
  </stage>
  <stage stageid="fc160215-a7b0-47ce-88d1-6cb930d91c50" name="num_Counter" type="Data">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <narrative>
    </narrative>
    <displayx>-210</displayx>
    <displayy>-75</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="57e675ea-2817-4cd8-b8fb-223eef3e28e1" name="Local data Items" type="Block">
    <subsheetid>527af26a-0380-4b23-bf67-fbfaf94f5412</subsheetid>
    <narrative>
    </narrative>
    <displayx>-270</displayx>
    <displayy>-150</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>165</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="0000FF" />
  </stage>
  <stage stageid="276077eb-9742-445f-ae06-df89095a2673" name="Initialise Counter" type="Calculation">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>-60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>32f2cd99-3f8f-4864-a99c-110eacb2c230</onsuccess>
    <calculation expression="0" stage="num_Counter" />
  </stage>
  <stage stageid="32f2cd99-3f8f-4864-a99c-110eacb2c230" name="Counter&lt;2" type="Decision">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>-15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[num_Counter]&lt;2" />
    <ontrue>83fc919f-95b7-4522-b41c-a3bb7d34a16c</ontrue>
    <onfalse>fcc85c00-176d-43ed-8cb4-9a672cff7ea5</onfalse>
  </stage>
  <stage stageid="fcc85c00-176d-43ed-8cb4-9a672cff7ea5" name="SE:Error in Move EMail" type="Exception">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <narrative>
    </narrative>
    <displayx>315</displayx>
    <displayy>-15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="System Exception" detail="&quot;Error in Move EMail:&quot; &amp; &quot;&quot; &amp;[txt_ErrorMessage]" />
  </stage>
  <stage stageid="8ed65ac5-390e-4757-a8f8-9a576201626b" name="Increase Counter" type="Calculation">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>105</displayx>
    <displayy>-15</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>32f2cd99-3f8f-4864-a99c-110eacb2c230</onsuccess>
    <calculation expression="[num_Counter]+1" stage="num_Counter" />
  </stage>
  <stage stageid="96e0df97-7a2a-4a02-91c6-92d78b12372c" name="Time Out1" type="WaitEnd">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>105</displayx>
    <displayy>90</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>8ed65ac5-390e-4757-a8f8-9a576201626b</onsuccess>
    <groupid>c998c9a7-e15d-4d87-80b8-6481fb56b3e4</groupid>
  </stage>
  <stage stageid="efddc4e6-9152-43e8-bd50-f9c9a5838a06" name="Wait1" type="WaitStart">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>105</displayx>
    <displayy>135</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <groupid>c998c9a7-e15d-4d87-80b8-6481fb56b3e4</groupid>
    <choices />
    <timeout>2</timeout>
  </stage>
  <stage stageid="7682b50c-e65f-4a0f-bc5f-31fe222c15f9" name="Retry" type="Decision">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>135</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[flag_MailMoved]" />
    <ontrue>1903c0a3-c03b-43b2-a370-d5d3436b8f5d</ontrue>
    <onfalse>efddc4e6-9152-43e8-bd50-f9c9a5838a06</onfalse>
  </stage>
  <stage stageid="99bb5c3f-ae5c-4e71-b907-228f8b0eae31" name="num_Counter" type="Data">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <narrative>
    </narrative>
    <displayx>-90</displayx>
    <displayy>15</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="5c27aee6-7ddc-4d40-a0f8-b7f1fb5b7383" name="Local data Items" type="Block">
    <subsheetid>225ea648-4849-46a0-8a10-f8e8552c1360</subsheetid>
    <narrative>
    </narrative>
    <displayx>-150</displayx>
    <displayy>-60</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>165</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="0000FF" />
  </stage>
  <stage stageid="fb554818-54dd-4545-b850-199c79426bf7" name="Initialise Counter" type="Calculation">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>33b1e13c-a722-40f9-8ec6-5ef938902f0a</onsuccess>
    <calculation expression="0" stage="num_Counter" />
  </stage>
  <stage stageid="33b1e13c-a722-40f9-8ec6-5ef938902f0a" name="Counter&lt;2" type="Decision">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[num_Counter]&lt;2" />
    <ontrue>7ce7c596-1197-40b0-801f-a78947b1ad35</ontrue>
    <onfalse>41935b73-c65c-433c-b440-9f4d80bc1b24</onfalse>
  </stage>
  <stage stageid="41935b73-c65c-433c-b440-9f4d80bc1b24" name="SE:Error in Forward EMail" type="Exception">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <narrative>
    </narrative>
    <displayx>270</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="System Exception" detail="&quot;Error in forward EMail:&quot; &amp; &quot;&quot; &amp;[txt_ErrorMessage]" />
  </stage>
  <stage stageid="40afd9c5-1e91-4f2d-81f8-b0037ae60adb" name="Increase Counter" type="Calculation">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>60</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>33b1e13c-a722-40f9-8ec6-5ef938902f0a</onsuccess>
    <calculation expression="[num_Counter]+1" stage="num_Counter" />
  </stage>
  <stage stageid="bd0575d2-f259-40bc-abcf-b8c86165695f" name="Time Out1" type="WaitEnd">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>60</displayx>
    <displayy>120</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>40afd9c5-1e91-4f2d-81f8-b0037ae60adb</onsuccess>
    <groupid>5e46906d-c4df-4a64-ac11-a8746a41b8ae</groupid>
  </stage>
  <stage stageid="6c00eca2-0a4c-48e9-8bfd-3f6701be0430" name="Wait1" type="WaitStart">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>60</displayx>
    <displayy>165</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <groupid>5e46906d-c4df-4a64-ac11-a8746a41b8ae</groupid>
    <choices />
    <timeout>2</timeout>
  </stage>
  <stage stageid="b63821b7-4223-4215-ad17-b276d3ccbac7" name="Retry" type="Decision">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>165</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[flag_MailForwarded]" />
    <ontrue>91779c5e-d946-46a0-9b47-b89d78ef746f</ontrue>
    <onfalse>6c00eca2-0a4c-48e9-8bfd-3f6701be0430</onfalse>
  </stage>
  <stage stageid="f44a8c07-8984-4c64-8868-47684d34b3b5" name="num_Counter" type="Data">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <narrative>
    </narrative>
    <displayx>-645</displayx>
    <displayy>0</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="0ea53169-cfc0-46b7-96fb-d5867bd81cd3" name="Local data Items" type="Block">
    <subsheetid>e5b54855-36be-4fb9-9765-9376d41fb2ff</subsheetid>
    <narrative>
    </narrative>
    <displayx>-705</displayx>
    <displayy>-75</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>165</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="0000FF" />
  </stage>
  <stage stageid="231a3761-a51e-476a-b25f-a9ba12331a26" name="Initialise Counter" type="Calculation">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>285</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>a67a70a0-5d19-4cfb-bd70-58e5e432c0cf</onsuccess>
    <calculation expression="0" stage="num_Counter" />
  </stage>
  <stage stageid="a67a70a0-5d19-4cfb-bd70-58e5e432c0cf" name="Counter&lt;2" type="Decision">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>285</displayx>
    <displayy>90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[num_Counter]&lt;2" />
    <ontrue>cbb14f25-284a-4e80-94f7-cbe91d955443</ontrue>
    <onfalse>75691f88-9a15-4b22-8172-d01f258c6861</onfalse>
  </stage>
  <stage stageid="75691f88-9a15-4b22-8172-d01f258c6861" name="SE:Error in Forward EMail" type="Exception">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <narrative>
    </narrative>
    <displayx>405</displayx>
    <displayy>90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="System Exception" detail="&quot;Error in forward EMail:&quot; &amp; &quot;&quot; &amp;[txt_ErrorMessage]" />
  </stage>
  <stage stageid="0ef74c73-d877-43e5-8e1a-ce3f74e5a67b" name="Increase Counter" type="Calculation">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>90</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>a67a70a0-5d19-4cfb-bd70-58e5e432c0cf</onsuccess>
    <calculation expression="[num_Counter]+1" stage="num_Counter" />
  </stage>
  <stage stageid="23fa6406-038e-42ad-99d8-33b056c2e572" name="Time Out1" type="WaitEnd">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>150</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>0ef74c73-d877-43e5-8e1a-ce3f74e5a67b</onsuccess>
    <groupid>873f2d42-1b47-4156-8b4c-89ba0a1a0d7c</groupid>
  </stage>
  <stage stageid="deee5c51-b850-4329-a235-fe237c603327" name="Wait1" type="WaitStart">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>210</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <groupid>873f2d42-1b47-4156-8b4c-89ba0a1a0d7c</groupid>
    <choices />
    <timeout>2</timeout>
  </stage>
  <stage stageid="8cf62d27-9860-4c06-a0d2-890e15661381" name="Retry" type="Decision">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>285</displayx>
    <displayy>210</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[flag_MailForwarded]" />
    <ontrue>a8d20cfc-5f50-4be5-8b03-ee7f10c2b216</ontrue>
    <onfalse>deee5c51-b850-4329-a235-fe237c603327</onfalse>
  </stage>
  <stage stageid="510ff791-8b01-4b78-8027-110038a8fe00" name="num_Counter" type="Data">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <narrative>
    </narrative>
    <displayx>-375</displayx>
    <displayy>165</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="51ead7e2-6644-4a51-8b78-69cb62dddcc0" name="Local data Items" type="Block">
    <subsheetid>646e7a7c-460a-4c99-8260-d3f68c1b3076</subsheetid>
    <narrative>
    </narrative>
    <displayx>-435</displayx>
    <displayy>90</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>165</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="0000FF" />
  </stage>
  <stage stageid="4eb2ecbb-0e1b-456c-87db-524d0f595343" name="Is Mail Id Empty?" type="Decision">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[txt_MessageId]=&quot;&quot;" />
    <ontrue>df3b584e-78b7-4563-a847-81668c9c29ee</ontrue>
    <onfalse>5cc32a81-c53b-4703-8114-21df7682343f</onfalse>
  </stage>
  <stage stageid="df3b584e-78b7-4563-a847-81668c9c29ee" name="Mail Id is empty" type="Exception">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <narrative>
    </narrative>
    <displayx>270</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;Error in Forward Mail: Mail Id cannot be empty&quot;" />
  </stage>
  <stage stageid="5cc32a81-c53b-4703-8114-21df7682343f" name="Initialise Counter" type="Calculation">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>7b89ad86-0270-4919-93ea-5ccb8b6eb65c</onsuccess>
    <calculation expression="0" stage="num_Counter" />
  </stage>
  <stage stageid="7b89ad86-0270-4919-93ea-5ccb8b6eb65c" name="Counter&lt;2" type="Decision">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[num_Counter]&lt;2" />
    <ontrue>93b6c766-baf0-43b7-b078-c51a2c822b14</ontrue>
    <onfalse>b096e218-d663-4f1c-b768-705286130e2e</onfalse>
  </stage>
  <stage stageid="b096e218-d663-4f1c-b768-705286130e2e" name="SE:Error in Forward EMail" type="Exception">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <narrative>
    </narrative>
    <displayx>270</displayx>
    <displayy>105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="System Exception" detail="&quot;Error in forward EMail:&quot; &amp; &quot;&quot; &amp;[txt_ErrorMessage]" />
  </stage>
  <stage stageid="ec22c3c0-3677-453a-bae0-1595a5861843" name="Increase Counter" type="Calculation">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>60</displayx>
    <displayy>105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>7b89ad86-0270-4919-93ea-5ccb8b6eb65c</onsuccess>
    <calculation expression="[num_Counter]+1" stage="num_Counter" />
  </stage>
  <stage stageid="6e10f6de-8f33-45a8-bf4c-8b4632901590" name="Time Out1" type="WaitEnd">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>60</displayx>
    <displayy>165</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>ec22c3c0-3677-453a-bae0-1595a5861843</onsuccess>
    <groupid>7b904ce9-649d-4f23-97e9-948bfa851a72</groupid>
  </stage>
  <stage stageid="a8823944-c1a0-4fd9-9a33-f102b6881ce3" name="Wait1" type="WaitStart">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>60</displayx>
    <displayy>225</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <groupid>7b904ce9-649d-4f23-97e9-948bfa851a72</groupid>
    <choices />
    <timeout>2</timeout>
  </stage>
  <stage stageid="915b3de5-6623-459b-9718-be105d34d9e9" name="Retry" type="Decision">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>150</displayx>
    <displayy>225</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[flag_MailForwarded]" />
    <ontrue>865756ce-e58e-4d3a-9055-6fe296cdc98a</ontrue>
    <onfalse>a8823944-c1a0-4fd9-9a33-f102b6881ce3</onfalse>
  </stage>
  <stage stageid="c1fa3bc5-3c31-42c7-8eb7-702a15987ac4" name="num_Counter" type="Data">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <narrative>
    </narrative>
    <displayx>-450</displayx>
    <displayy>60</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="eafbd79a-bb93-4937-b273-475d432d35e2" name="Local data Items" type="Block">
    <subsheetid>4ee2dc4d-dc00-429a-9195-eab4a5570870</subsheetid>
    <narrative>
    </narrative>
    <displayx>-510</displayx>
    <displayy>-15</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>165</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="0000FF" />
  </stage>
  <stage stageid="02c9b75f-2f9f-48ee-b460-be4d01417f89" name="Is Mail Id Empty?" type="Decision">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[txt_MessageId]=&quot;&quot;" />
    <ontrue>1c5ee821-aebe-4641-8fe3-0adbbcd76639</ontrue>
    <onfalse>3d3d8046-ca1e-4c95-b1b5-4ab9f30fa3d7</onfalse>
  </stage>
  <stage stageid="1c5ee821-aebe-4641-8fe3-0adbbcd76639" name="Mail Id is empty" type="Exception">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>
    </narrative>
    <displayx>240</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;Error in Forward Mail: Mail Id cannot be empty&quot;" />
  </stage>
  <stage stageid="3d3d8046-ca1e-4c95-b1b5-4ab9f30fa3d7" name="Initialise Counter" type="Calculation">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>f3755d3c-40a7-41a7-8c4f-9b4caeeda26e</onsuccess>
    <calculation expression="0" stage="num_Counter" />
  </stage>
  <stage stageid="f3755d3c-40a7-41a7-8c4f-9b4caeeda26e" name="Counter&lt;2" type="Decision">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>150</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[num_Counter]&lt;2" />
    <ontrue>f06c2ce9-ecb5-44bb-91a3-5ffec135fbe3</ontrue>
    <onfalse>dfd140d4-51ee-44c7-8b79-3c82d6d11ee4</onfalse>
  </stage>
  <stage stageid="dfd140d4-51ee-44c7-8b79-3c82d6d11ee4" name="SE:Error in save EMail" type="Exception">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>
    </narrative>
    <displayx>240</displayx>
    <displayy>150</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="System Exception" detail="&quot;Error in save EMail:&quot; &amp; &quot;&quot; &amp;[txt_ErrorMessage]" />
  </stage>
  <stage stageid="64a2d438-5505-4904-8bc5-0e127869f1e6" name="Increase Counter" type="Calculation">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>150</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>f3755d3c-40a7-41a7-8c4f-9b4caeeda26e</onsuccess>
    <calculation expression="[num_Counter]+1" stage="num_Counter" />
  </stage>
  <stage stageid="7c32e1d7-b99d-4610-a71f-94c16ad6029e" name="Time Out1" type="WaitEnd">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>210</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>64a2d438-5505-4904-8bc5-0e127869f1e6</onsuccess>
    <groupid>c34d6189-e6f8-4523-8f0a-9ce5c46ee811</groupid>
  </stage>
  <stage stageid="b3044f0b-5b34-4d70-a047-c3647fcd3ce3" name="Wait1" type="WaitStart">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>270</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <groupid>c34d6189-e6f8-4523-8f0a-9ce5c46ee811</groupid>
    <choices />
    <timeout>2</timeout>
  </stage>
  <stage stageid="ae49f1ff-f651-4dd0-8423-d2dc0537cab8" name="Retry" type="Decision">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>270</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[flag_MailSaved]" />
    <ontrue>f5824718-ea58-4e56-88c9-960c78f4292f</ontrue>
    <onfalse>b3044f0b-5b34-4d70-a047-c3647fcd3ce3</onfalse>
  </stage>
  <stage stageid="7829567e-2027-4abe-a0be-bf61bb152490" name="num_Counter" type="Data">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>
    </narrative>
    <displayx>-555</displayx>
    <displayy>45</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="ef8fb118-72dd-4bb1-80f0-78a6b4364f3b" name="Local data Items" type="Block">
    <subsheetid>a6472286-536c-49fc-bf03-869a0445e1f4</subsheetid>
    <narrative>
    </narrative>
    <displayx>-615</displayx>
    <displayy>-30</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>165</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="0000FF" />
  </stage>
  <stage stageid="22284623-d89d-4c23-b50b-c7a034c9f19c" name="Counter&lt;2" type="Decision">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[num_Counter]&lt;2" />
    <ontrue>68beff7f-6757-4a4b-a677-044463d000bc</ontrue>
    <onfalse>9297cf47-d746-41ec-b383-20743f143fa0</onfalse>
  </stage>
  <stage stageid="cf9e232b-fee7-40fa-8c0c-567807f1a135" name="Increase Counter" type="Calculation">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-15</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>22284623-d89d-4c23-b50b-c7a034c9f19c</onsuccess>
    <calculation expression="[num_Counter]+1" stage="num_Counter" />
  </stage>
  <stage stageid="9297cf47-d746-41ec-b383-20743f143fa0" name="SE:Error in get Email" type="Exception">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="System Exception" detail="&quot;Error in get Email :&quot; &amp; &quot;&quot; &amp;[txt_ErrorMessage]" />
  </stage>
  <stage stageid="eaac20a7-9b73-46e1-a8f6-9000fe0ecf20" name="Initialise Counter" type="Calculation">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>-60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>22284623-d89d-4c23-b50b-c7a034c9f19c</onsuccess>
    <calculation expression="0" stage="num_Counter" />
  </stage>
  <stage stageid="e3ee748f-06f3-4280-992c-2c4486e423ee" name="Retry" type="Decision">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>90</displayx>
    <displayy>150</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[txt_ErrorMessage] = &quot;&quot;" />
    <ontrue>824f12c2-46c5-4e90-b14e-d4007e1c4823</ontrue>
    <onfalse>88939d01-c253-4f87-82db-1dd4ca0641b5</onfalse>
  </stage>
  <stage stageid="9ff29b00-2ce5-490f-963b-6ade5bda772d" name="Time Out1" type="WaitEnd">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-15</displayx>
    <displayy>60</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>cf9e232b-fee7-40fa-8c0c-567807f1a135</onsuccess>
    <groupid>c6d0a619-656a-48e0-a05d-80b0ca23c728</groupid>
  </stage>
  <stage stageid="88939d01-c253-4f87-82db-1dd4ca0641b5" name="Wait1" type="WaitStart">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-15</displayx>
    <displayy>150</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <groupid>c6d0a619-656a-48e0-a05d-80b0ca23c728</groupid>
    <choices />
    <timeout>2</timeout>
  </stage>
  <stage stageid="e028d605-9114-4efd-8886-015e85bf029e" name="num_Counter" type="Data">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <narrative>
    </narrative>
    <displayx>-675</displayx>
    <displayy>90</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="307d5aa3-1044-4444-a1b4-e1fde57c9c6d" name="Local data Items" type="Block">
    <subsheetid>33693b0c-1272-4a99-bf9a-d457e4b4c290</subsheetid>
    <narrative>
    </narrative>
    <displayx>-735</displayx>
    <displayy>15</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>165</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="0000FF" />
  </stage>
  <stage stageid="4d58ba73-173e-4764-ab07-b175387e0c26" name="Initialise Counter" type="Calculation">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>45a7a115-8e1b-4158-8d37-1ab68b3682f9</onsuccess>
    <calculation expression="0" stage="num_Counter" />
  </stage>
  <stage stageid="45a7a115-8e1b-4158-8d37-1ab68b3682f9" name="Counter&lt;2" type="Decision">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[num_Counter]&lt;2" />
    <ontrue>b72f8aef-ec8e-4291-8f87-7d1d98e4a6e1</ontrue>
    <onfalse>c0266e0d-b37d-4e74-96d7-ea5b8fac6dc5</onfalse>
  </stage>
  <stage stageid="c0266e0d-b37d-4e74-96d7-ea5b8fac6dc5" name="SE:Error in configure EWS" type="Exception">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <narrative>
    </narrative>
    <displayx>315</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="System Exception" detail="&quot;Error in configure EWS:&quot; &amp; &quot;&quot; &amp;[txt_ErrorMessage]" />
  </stage>
  <stage stageid="1de6f9a0-050e-4927-a9c1-0b2c567a24d1" name="Increase Counter" type="Calculation">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>105</displayx>
    <displayy>45</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>45a7a115-8e1b-4158-8d37-1ab68b3682f9</onsuccess>
    <calculation expression="[num_Counter]+1" stage="num_Counter" />
  </stage>
  <stage stageid="705adead-c574-44bc-b31d-507ea0e90045" name="Retry" type="Decision">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>195</displayx>
    <displayy>165</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[flag_Success]" />
    <ontrue>342ad013-4186-43a5-a613-37509f7a4c40</ontrue>
    <onfalse>6c9eb1fe-d8dc-4355-86eb-872355510a9f</onfalse>
  </stage>
  <stage stageid="63fe23ab-fe31-4b09-b772-f59567d92484" name="Time Out1" type="WaitEnd">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>105</displayx>
    <displayy>120</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>1de6f9a0-050e-4927-a9c1-0b2c567a24d1</onsuccess>
    <groupid>4d9ac4b7-5d53-402e-ba7e-aca36103976a</groupid>
  </stage>
  <stage stageid="6c9eb1fe-d8dc-4355-86eb-872355510a9f" name="Wait1" type="WaitStart">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>105</displayx>
    <displayy>165</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <groupid>4d9ac4b7-5d53-402e-ba7e-aca36103976a</groupid>
    <choices />
    <timeout>2</timeout>
  </stage>
  <stage stageid="deeb3d44-74ed-4a09-9c5d-4a5a8623f8fc" name="num_Counter" type="Data">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <narrative>
    </narrative>
    <displayx>-525</displayx>
    <displayy>30</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="708692eb-cbec-4904-ad69-742c1734da0c" name="Local data Items" type="Block">
    <subsheetid>30f9d029-16b2-471e-b882-1f8553a514ca</subsheetid>
    <narrative>
    </narrative>
    <displayx>-600</displayx>
    <displayy>-45</displayy>
    <displaywidth>150</displaywidth>
    <displayheight>165</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="0000FF" />
  </stage>
  <stage stageid="fb371042-f6e4-4583-ab3d-af2d1d84ac9d" name="Get Email By UniqueID - Overload" type="SubSheetInfo">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>Gets email by unique message ID</narrative>
    <displayx>-345</displayx>
    <displayy>-135</displayy>
    <displaywidth>180</displaywidth>
    <displayheight>90</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
  </stage>
  <stage stageid="91bc6315-02b9-4f54-af4a-03fd0fe00f20" name="Start" type="Start">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>-120</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="Attachment Directory" narrative="Optional. Folder on computer or network where any attachments should be saved to.  If not set than attachments will be ignored" stage="txt_AttachmentDirectory" />
      <input type="text" name="MailUniqueId" narrative="Mandatory , Mail Unique ID" stage="txt_MailUniqueId" />
    </inputs>
    <onsuccess>4a5689ef-a2ec-41ee-9e8f-20fddabd276b</onsuccess>
  </stage>
  <stage stageid="da7518b5-4ea3-4cd2-9446-f7bb7a17f0ff" name="End" type="End">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>225</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <outputs>
      <output type="text" name="SenderName" narrative="Name of the mail Sender" stage="txt_SenderName" />
      <output type="text" name="SenderMailAddress" narrative="Mail address of the Sender" stage="txt_SenderMailAddress" />
      <output type="text" name="Subject" narrative="The Subject of the Mail" stage="txt_MailSubject" />
      <output type="text" name="MailBody" narrative="The Body of the message" stage="txt_MailBody" />
      <output type="text" name="To" narrative="Mail Recipients in the To seperated by Semicolon" stage="txt_To" />
      <output type="text" name="CC" narrative="Mail Recipients in the CC seperated by Semicolon" stage="txt_CC" />
      <output type="datetime" name="MailSentTime" narrative="Mail Sent Time" stage="dt_MailSentTime" />
      <output type="datetime" name="MailReceivedTime" narrative="Mail Received Time" stage="dt_MailReceivedTime" />
      <output type="number" name="AttachmentCount" narrative="Attachment Count" stage="num_AttachmentCount" />
      <output type="text" name="AttachmentNames" narrative="Names of the Attachment separated by semicolon " stage="txt_AttachmentNames" />
      <output type="flag" name="GotMail" narrative="Flag. Got any mail" stage="flag_GotMail" />
      <output type="text" name="ErrorMessage" narrative="Error message if any" stage="txt_ErrorMessage" />
    </outputs>
  </stage>
  <stage stageid="d0ba8582-b5f8-4a02-94f8-0143a33952af" name="flag_GotMail" type="Data">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>Flag to check if received email</narrative>
    <displayx>-465</displayx>
    <displayy>360</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>flag</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="6b31dc08-71c7-4490-bb95-e99971c3ebf9" name="txt_AttachmentDirectory" type="Data">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>Folder for downloading email attachments</narrative>
    <displayx>-540</displayx>
    <displayy>45</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue xml:space="preserve">C:\EscanProcessFolders\Overload</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="28984d3b-7011-4124-a1f8-758a40c1006b" name="txt_ErrorMessage" type="Data">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>Error Message</narrative>
    <displayx>-465</displayx>
    <displayy>540</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="7ee6fba4-c3ef-4f24-a38d-311272de00bb" name="txt_SenderName" type="Data">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>Sender name</narrative>
    <displayx>-555</displayx>
    <displayy>360</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="1f5e7c8e-8c22-409e-b4a3-23dcaeb4ecf7" name="txt_SenderMailAddress" type="Data">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>Email ID value for sender</narrative>
    <displayx>-555</displayx>
    <displayy>450</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="28357e43-d262-4a50-a180-471cd57329ea" name="txt_MailBody" type="Data">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>Email body</narrative>
    <displayx>-555</displayx>
    <displayy>405</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="c1969cab-08f0-489b-bcf4-b97683cdaa26" name="txt_AttachmentNames" type="Data">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>Name of the email attachment</narrative>
    <displayx>-555</displayx>
    <displayy>540</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="d62a6500-82c5-4025-b640-01d0498b2f62" name="txt_To" type="Data">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>Value for TO addresses in email</narrative>
    <displayx>-465</displayx>
    <displayy>315</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="0ab059a2-8db2-4d89-9428-95494f6f0769" name="txt_CC" type="Data">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>Value for CC in email</narrative>
    <displayx>-465</displayx>
    <displayy>405</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="4381c0b0-833b-4ad1-ada3-caf40b1560b6" name="txt_MailUniqueId" type="Data">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>ID generated for emails</narrative>
    <displayx>-540</displayx>
    <displayy>-15</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue xml:space="preserve">AAMkADE1YmViNDM0LTVlYzctNDM4Mi1hZmZjLTJlMWJkMDgwOTI3YQBGAAAAAACDPFolDEuDQL1xS2sNtjeGBwCfoqsRXKdnRYd1Bf9CVAPrAAAAAAEMAACfoqsRXKdnRYd1Bf9CVAPrAAA0t3AEAAA=</initialvalue>
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="b3f46a4a-e9fb-4a14-bb85-655f361b7b1e" name="dt_MailSentTime" type="Data">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>Send time for email</narrative>
    <displayx>-555</displayx>
    <displayy>495</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>datetime</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="a422c855-3ad5-411a-939d-132a49f88614" name="dt_MailReceivedTime" type="Data">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>Received time of email</narrative>
    <displayx>-465</displayx>
    <displayy>495</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>datetime</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="c3bb22c5-f96c-48cb-abea-76a2802e1959" name="txt_MailSubject" type="Data">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>Email subject</narrative>
    <displayx>-465</displayx>
    <displayy>450</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>text</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="5e3e0158-302e-4c47-8400-b57415593cf9" name="num_AttachmentCount" type="Data">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>Count of email attachments</narrative>
    <displayx>-555</displayx>
    <displayy>315</displayy>
    <displaywidth>90</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="629a98ef-3ffa-4109-a4ee-fe3ee9794dc4" name="Is Mail Id Empty?" type="Decision">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[txt_MailUniqueId]=&quot;&quot;" />
    <ontrue>f3c7146e-5432-45a6-8b1e-dc27dd8d24d5</ontrue>
    <onfalse>b6582ded-9eb0-41ad-ada0-3657fd083d1a</onfalse>
  </stage>
  <stage stageid="f3c7146e-5432-45a6-8b1e-dc27dd8d24d5" name="Mail Unique Id is empty" type="Exception">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="Business Exception" detail="&quot;Error in Get Email By ID : Mail Unique Id cannot be empty&quot;" />
  </stage>
  <stage stageid="8b302a2a-7532-4a1f-823c-82de1dffc0ae" name="Input data Items" type="Block">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>
    </narrative>
    <displayx>-615</displayx>
    <displayy>-75</displayy>
    <displaywidth>165</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="008000" />
  </stage>
  <stage stageid="b541177c-b89b-4bb8-a6a0-d7eb63ba71fd" name="Output data Items" type="Block">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>
    </narrative>
    <displayx>-615</displayx>
    <displayy>90</displayy>
    <displaywidth>165</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF00FF" />
  </stage>
  <stage stageid="606a5cc2-1997-4e5d-9f2f-e0856ef91f29" name="Local data Items" type="Block">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>
    </narrative>
    <displayx>-615</displayx>
    <displayy>270</displayy>
    <displaywidth>225</displaywidth>
    <displayheight>360</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="0000FF" />
  </stage>
  <stage stageid="5285167d-a85c-4219-a418-c6811b17110d" name="Global data Items" type="Block">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>
    </narrative>
    <displayx>-420</displayx>
    <displayy>-75</displayy>
    <displaywidth>165</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FF6600" />
  </stage>
  <stage stageid="d06060c6-2190-438e-a7c0-fc2ce51d951e" name="Environmental data Items" type="Block">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>
    </narrative>
    <displayx>-420</displayx>
    <displayy>90</displayy>
    <displaywidth>165</displaywidth>
    <displayheight>150</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="FFFF00" />
  </stage>
  <stage stageid="b6582ded-9eb0-41ad-ada0-3657fd083d1a" name="Get Email By ID211" type="Code">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>105</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <inputs>
      <input type="text" name="AttachmentDirectory" expr="[txt_AttachmentDirectory]" />
      <input type="text" name="MailUniqueId" expr="[txt_MailUniqueId]" />
    </inputs>
    <outputs>
      <output type="text" name="SenderName" stage="txt_SenderName" />
      <output type="text" name="SenderMailAddress" stage="txt_SenderMailAddress" />
      <output type="text" name="MailSubject" stage="txt_MailSubject" />
      <output type="text" name="MailBody" stage="txt_MailBody" />
      <output type="number" name="AttachmentCount" stage="num_AttachmentCount" />
      <output type="text" name="AttachmentNames" stage="txt_AttachmentNames" />
      <output type="text" name="To" stage="txt_To" />
      <output type="text" name="CC" stage="txt_CC" />
      <output type="datetime" name="MailSentTime" stage="dt_MailSentTime" />
      <output type="datetime" name="MailReceivedTime" stage="dt_MailReceivedTime" />
      <output type="flag" name="Success" stage="flag_GotMail" />
      <output type="text" name="ErrorMessage" stage="txt_ErrorMessage" />
    </outputs>
    <onsuccess>e4ce7774-2e0d-466f-9f07-d15f80c48840</onsuccess>
    <code><![CDATA[Success = false;ErrorMessage ="";SenderName="";SenderMailAddress="";MailSubject="";MailBody="";AttachmentCount=0;
AttachmentNames="";To="";CC="";MailSentTime=default(DateTime);MailReceivedTime=default(DateTime);

//Item mailItem =null;
//EmailMessage mailMessage = null;


try
{
	if(!connected)
	{
		throw new Exception("Exchange Web Service is not configured.Please call 'Configure EWS' action first");
	}

		//Bind email
	EmailMessage email = EmailMessage.Bind(service, new ItemId(MailUniqueId));

	if(email!=null)
	{

		SenderName = email.Sender.Name;
		SenderMailAddress = email.Sender.Address;
		MailSubject = email.Subject;
		PropertySet properties = (BasePropertySet.FirstClassProperties);
		properties.RequestedBodyType = BodyType.HTML;
		email.Load(properties);
		MailBody = email.Body;
		AttachmentCount = email.Attachments.Count;
		int index=0;
		
		//Save attachments in the Directory
		if(AttachmentDirectory!="")
		{
			if(!AttachmentDirectory.EndsWith(@"\"))
			{
				AttachmentDirectory+=@"\";
			}
			foreach (Attachment attachment in email.Attachments)
			{
				 AttachmentNames += attachment.Name +";";
				 
				 try{
				 FileAttachment attach = (FileAttachment) email.Attachments[index];
				 attach.Load(@AttachmentDirectory+attach.Name);
				 }
				 catch
				 {					 
					 try{
					 //File textfile ()
					 ItemAttachment itemAttachment = attachment as ItemAttachment;
        			 itemAttachment.Load();
						EmailMessage msg = (EmailMessage)(itemAttachment.Item);
						TextWriter tsw = new StreamWriter(@AttachmentDirectory + "msg_" + DateTime.Now.ToString("yyyyMMddHHmmss") +".html");
						tsw.WriteLine("From:		" + msg.Sender.Name + "<" + msg.Sender.Address + ">" + "<br>");
						tsw.WriteLine("To:		" + itemAttachment.Item.DisplayTo + "<br>" );										
						tsw.WriteLine("Subject:		" + itemAttachment.Item.Subject + "<br>");
						tsw.WriteLine("Dates:		" + itemAttachment.Item.DateTimeReceived + "<br>" );
						tsw.Write(itemAttachment.Item.Body);
						tsw.Close();
					 }
					 catch
					 {}
										 
				 }		 
				 
				 
				 index++;
			}
			if(AttachmentNames!=""&&AttachmentNames.EndsWith(";"))
			{
				AttachmentNames = AttachmentNames.Remove(AttachmentNames.Length-1);
			}
		}
		
		MailReceivedTime = DateTime.Parse(email.DateTimeReceived.ToString());
		MailSentTime = email.DateTimeSent.ToLocalTime();
		
		foreach (EmailAddress toAddress in email.ToRecipients)
		{
			 To += toAddress.Address + ";";
		}
		if(To!=""&&To.EndsWith(";"))
		{
			To = To.Remove(To.Length-1);
		}
		foreach (EmailAddress ccAddress in email.CcRecipients)
		{
			 CC += ccAddress.Address + ";";
		}
		if(CC!=""&&CC.EndsWith(";"))
		{
			CC = CC.Remove(CC.Length-1);
		}
		//email.IsRead = true;
		//email.Update(ConflictResolutionMode.AutoResolve);
		
		Success =true;
	
	}
	else
	{
		Success =false;
	ErrorMessage = "Email not found";

		}
}
catch(Exception ex)
{
	Success =false;
	ErrorMessage = "Error in Get Email: "+ex.Message;
}]]></code>
  </stage>
  <stage stageid="4a5689ef-a2ec-41ee-9e8f-20fddabd276b" name="Initialise Counter" type="Calculation">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>-60</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>7baf306e-0d5b-4a44-9772-86886e866aa4</onsuccess>
    <calculation expression="0" stage="num_Counter" />
  </stage>
  <stage stageid="7baf306e-0d5b-4a44-9772-86886e866aa4" name="Counter&lt;2" type="Decision">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[num_Counter]&lt;2" />
    <ontrue>629a98ef-3ffa-4109-a4ee-fe3ee9794dc4</ontrue>
    <onfalse>b65cf214-a3ad-4fc5-ba9a-4c4b4e53932e</onfalse>
  </stage>
  <stage stageid="9e6da35a-4e5b-417b-a940-4b0ceccbba0b" name="Increase Counter" type="Calculation">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-75</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>7baf306e-0d5b-4a44-9772-86886e866aa4</onsuccess>
    <calculation expression="[num_Counter]+1" stage="num_Counter" />
  </stage>
  <stage stageid="b65cf214-a3ad-4fc5-ba9a-4c4b4e53932e" name="SE:Error in get Email" type="Exception">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>
    </narrative>
    <displayx>120</displayx>
    <displayy>0</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <exception type="System Exception" detail="&quot;Error in get Email :&quot; &amp; &quot;&quot; &amp;[txt_ErrorMessage]" />
  </stage>
  <stage stageid="e4ce7774-2e0d-466f-9f07-d15f80c48840" name="Retry" type="Decision">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>30</displayx>
    <displayy>150</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <decision expression="[flag_GotMail]" />
    <ontrue>da7518b5-4ea3-4cd2-9446-f7bb7a17f0ff</ontrue>
    <onfalse>fd611f93-bee1-456e-98c8-886377bd8749</onfalse>
  </stage>
  <stage stageid="a3506d2a-df7a-43f1-bc69-bcec3ce96064" name="num_Counter" type="Data">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <narrative>
    </narrative>
    <displayx>-510</displayx>
    <displayy>585</displayy>
    <displaywidth>60</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <datatype>number</datatype>
    <initialvalue />
    <private />
    <alwaysinit />
  </stage>
  <stage stageid="03703d22-956c-4294-9d2d-93733ce037cd" name="Time Out1" type="WaitEnd">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-75</displayx>
    <displayy>105</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <onsuccess>9e6da35a-4e5b-417b-a940-4b0ceccbba0b</onsuccess>
    <groupid>6c2143d7-7cfd-4d81-b096-b05d4792e494</groupid>
  </stage>
  <stage stageid="fd611f93-bee1-456e-98c8-886377bd8749" name="Wait1" type="WaitStart">
    <subsheetid>2ea9bff2-d376-418b-a134-ed38ce1c9903</subsheetid>
    <loginhibit />
    <narrative>
    </narrative>
    <displayx>-75</displayx>
    <displayy>150</displayy>
    <displaywidth>30</displaywidth>
    <displayheight>30</displayheight>
    <font family="Segoe UI" size="10" style="Regular" color="000000" />
    <groupid>6c2143d7-7cfd-4d81-b096-b05d4792e494</groupid>
    <choices />
    <timeout>2</timeout>
  </stage>
</process>